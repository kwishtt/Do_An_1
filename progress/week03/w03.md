# Tuần 3 — Tạo nhãn thành công & EDA cơ bản

Mục tiêu
- Định nghĩa nhãn thành công cho phim và hiểu tổng quan dữ liệu.

Việc cần làm
- Tính ROI = Revenue / Budget và tạo cột `Success` theo quy tắc (ví dụ ROI ≥ 1 và Vote Average ≥ 6.5).
- Thực hiện phân tích khám phá dữ liệu (đếm phim, tỉ lệ thành công, phân bố Budget/Revenue).
- Vẽ 2–3 biểu đồ đơn giản minh hoạ các phát hiện chính.

Giao nộp
- Dataset có nhãn + tóm tắt EDA (1 trang) và vài biểu đồ.

Checklist
- [x] Tạo cột ROI và `Success`
- [x] Thống kê số liệu cơ bản
- [x] Tạo 2–3 biểu đồ EDA

# CHI TIẾT THỰC HIỆN

## 1. Bước chuẩn bị (Imports)

```python
import pandas as pd, numpy as np
import seaborn as sns, matplotlib.pyplot as plt
from datetime import datetime
import os
```

**Thư viện dùng:**
- **pandas** (pd): Xử lý DataFrame, thống kê
- **numpy** (np): Tính toán, replace NaN
- **seaborn, matplotlib**: Vẽ biểu đồ
- **datetime, os**: Xử lý thời gian và đường dẫn

---

## 2. Bước 1: Tải dữ liệu & Khảo sát nhanh

**Đầu vào:** `data/clean_movies.csv`

**Công việc:**
1. Đọc file CSV bằng `pd.read_csv()`
2. Tạo bản copy để không thay đổi dữ liệu gốc
3. Kiểm tra:
   - Số bản ghi (hàng) và số cột
   - Kiểu dữ liệu của từng cột → `df.info()`
   - Thống kê mô tả (min, max, mean, ...) → `df.describe()`
   - Giá trị thiếu (NaN) → `df.isna().sum()`

**Kết quả:**
- Thấy được cấu trúc dữ liệu
- Phát hiện cột nào có giá trị thiếu
- Xác định kiểu dữ liệu cần chuyển đổi

---

## 3. Bước 2: Xử lý Budget & Revenue

**Mục đích:** Làm sạch dữ liệu budget/revenue trước khi tính ROI

**Công việc:**
1. **Tìm số lượng giá trị 0** trong Budget và Revenue
   - Giá trị 0 thường nghĩa là dữ liệu thiếu, không phải giá trị thực
2. **Chuyển 0 → NaN**
   ```python
   df['Budget'] = df['Budget'].replace(0, np.nan)
   df['Revenue'] = df['Revenue'].replace(0, np.nan)
   ```
3. **Xóa hàng thiếu dữ liệu**
   - Dùng `df.dropna(subset=['Budget', 'Revenue'])`
   - Vì ROI = Revenue / Budget, cần cả 2 giá trị

**Quyết định:** Xóa thay vì điền vì:
- Dữ liệu ROI cần đủ độ chính xác
- Điền dữ liệu sẽ gây sai lệch phân tích

**Kết quả:**
- Số hàng bị xóa (vì thiếu Budget hoặc Revenue)
- Số hàng còn lại (dùng cho các bước tiếp theo)

---

## 4. Bước 3: Xử lý Release Date & Trích xuất đặc trưng thời gian

**Mục đích:** Tạo các đặc trưng mới từ ngày phát hành

**Công việc:**
1. **Chuyển sang kiểu datetime**
   ```python
   df['Release Date'] = pd.to_datetime(df['Release Date'], errors='coerce')
   ```
   - `errors='coerce'` → biến giá trị lỗi thành NaT (null)

2. **Trích xuất 3 đặc trưng mới:**
   - **release_year**: Năm phát hành
   - **release_month**: Tháng (1-12)
   - **release_weekday**: Ngày trong tuần (0=Thứ 2, ..., 6=Chủ nhật)

**Ý tưởng:** Các yếu tố thời gian có thể ảnh hưởng đến thành công phim
- Phim phát hành vào dịp lễ tết → có thể đạt doanh thu cao hơn
- Phim phát hành vào cuối tuần → xem nhiều hơn

**Kết quả:**
- 3 cột mới trong dataset
- Có thể dùng trong mô hình ML sau

---

## 5. Bước 4: Tính ROI & Tạo nhãn Success

**Công thức ROI:**
$$ROI = \frac{Revenue}{Budget}$$

**Giải thích:**
- ROI < 1.0: Phim lỗ (doanh thu < chi phí)
- ROI = 1.0: Phim hòa vốn
- ROI > 1.0: Phim lãi (doanh thu > chi phí)

**Tạo nhãn Success (Target):**
```python
success = (roi >= 1.0) AND (Vote Average >= 6.5)
```

**Quyết định ngưỡng:**
- **ROI ≥ 1.0**: Phim phải kiếm được lợi nhuận
- **Vote Average ≥ 6.5**: Phim phải có chất lượng tốt (>6.5/10)
- **Cả 2 điều kiện**: Success = 1 (phim thực sự thành công)

**Kết quả:**
- Cột `roi`: Giá trị ROI của từng phim
- Cột `success`: Nhãn 0/1
  - 1 = Phim thành công
  - 0 = Phim không thành công
- Thống kê:
  - Số phim thành công
  - Số phim không thành công
  - Tỉ lệ (%)

---

## 6. Bước 5: Kiểm tra Cân bằng Lớp (Class Balance)

**Mục đích:** Phát hiện xem dữ liệu có bị mất cân bằng không

**Công việc:**
1. Đếm số phim success=1 vs success=0
2. Tính **imbalance ratio** = max_count / min_count

**Giải thích:**
- Ratio < 3 → Cân bằng tốt ✓
- Ratio > 3 → Imbalanced ⚠️
  - Model có thể học thiên lệch
  - Cần xử lý SMOTE hoặc class_weight (tuần sau)

**Kết quả:**
- Phát hiện được tỉ lệ lớp
- Ghi chú để xử lý nếu cần

---

## 7. Bước 6: Tạo 3 Biểu đồ EDA

### **Biểu đồ 1: Phân bố ROI**
- **Loại:** Histogram + KDE
- **Mục đích:** Xem phim thành công/không thành công
- **Điểm chính:** Đường thẳng đỏ = ROI = 1.0 (hòa vốn)
- **Lưu:** `chart/roi_distribution.png`

### **Biểu đồ 2: Ngân sách theo kết quả**
- **Loại:** Boxplot (so sánh 2 nhóm)
- **Mục đích:** So sánh budget phim thành công vs không
- **Đặc biệt:** Dùng log-scale (vì giá trị budget chênh lệch lớn)
- **Lưu:** `chart/budget_by_success.png`

### **Biểu đồ 3: Tỷ lệ thành công theo thể loại**
- **Loại:** Bar chart (top 10 genres)
- **Mục đích:** Xem thể loại phim nào thành công nhất
- **Công việc:**
  1. Tách cột Genres (1 phim có nhiều genre)
  2. Tính tỷ lệ thành công cho mỗi genre
  3. Lấy top 10 genre có nhiều phim nhất
- **Lưu:** `chart/success_rate_by_genre.png`

---

## 8. Bước 7: Lưu dữ liệu đã gắn nhãn

**Đầu vào:** DataFrame đã xử lý (df_work)

**Công việc:**
1. Lưu DataFrame đã có cột `success` vào CSV
2. Đường dẫn: `data/clean_movies_with_labels.csv`
3. Không lưu index (index=False)

**File output:**
- `data/clean_movies_with_labels.csv` ← Dùng cho tuần 4 trở đi

---

## 9. Tóm tắt Kết quả

| Công việc | Kết quả |
|-----------|---------|
| **Tải dữ liệu** | ✓ Thành công |
| **Xử lý Budget/Revenue** | ✓ Xóa 0 → NaN, loại hàng thiếu |
| **Trích xuất đặc trưng thời gian** | ✓ 3 cột mới: release_year, release_month, release_weekday |
| **Tính ROI** | ✓ ROI = Revenue / Budget |
| **Tạo nhãn Success** | ✓ ROI ≥ 1.0 AND Vote Average ≥ 6.5 |
| **Kiểm tra cân bằng lớp** | ✓ Tính imbalance ratio |
| **Vẽ 3 biểu đồ EDA** | ✓ ROI, Budget, Genres |
| **Lưu dữ liệu** | ✓ `data/clean_movies_with_labels.csv` |

---

## 10. Bước tiếp theo
- Nếu imbalanced → xử lý SMOTE (tuần 4)
- Xem xét outlier trong ROI (vẽ thêm biểu đồ box plot)
- Có thể thêm đặc trưng khác (tháng, kiểu phim, ...)
- Xây dựng mô hình dự đoán success (tuần 4-5)