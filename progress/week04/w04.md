# Tuần 4 — Feature Engineering (Chuẩn bị đặc trưng)

Mục tiêu
- Chuyển thông tin thô thành các đặc trưng hữu ích cho mô hình.

Việc cần làm
- Tạo cột năm/tháng/ngày trong tuần từ `Release Date`.
- Nhóm runtime (short/medium/long), đếm số diễn viên chính, chuẩn hóa `Genres`.
- Lập danh sách cuối cùng các đặc trưng và giải thích ý nghĩa (dạng dễ hiểu).

Giao nộp
- Bảng đặc trưng cuối cùng và mô tả ngắn cho từng đặc trưng.

Checklist
- [x] Tạo các cột thời gian (năm/tháng/weekday)
- [x] Nhóm runtime và đếm số diễn viên
- [x] Chuẩn hóa `Genres` và `Country`

# Chi tiết thực hiện

### Bước 1: Đọc dữ liệu đã gắn nhãn từ bước 3
- **Đã làm gì**: Tải file `clean_movies_with_labels.csv` vào DataFrame, kiểm tra số hàng/cột, kiểu dữ liệu và giá trị thiếu.
- **Công dụng**: Cung cấp dữ liệu gốc với nhãn thành công để bắt đầu xử lý đặc trưng.
- **Tác dụng**: DataFrame sẵn sàng với 1020 hàng và 22 cột, phát hiện missing values ở `Release Date` và các cột thời gian.
- **Ảnh hưởng**: Đảm bảo dữ liệu đầu vào sạch, giúp tránh lỗi trong các bước sau và cải thiện độ chính xác của mô hình.

### Bước 2: Trích xuất đặc trưng thời gian từ 'Release Date'
- **Đã làm gì**: Chuyển `Release Date` thành datetime, tạo cột `release_year`, `release_month`, `release_weekday`, `release_quarter`, và `is_holiday_season` (tháng 11-1).
- **Công dụng**: Tạo đặc trưng thời gian để mô hình học pattern theo mùa, năm, ngày trong tuần.
- **Tác dụng**: Thêm 5 cột mới, giúp phân tích xu hướng phát hành phim (vd: phim hè hay lễ hội).
- **Ảnh hưởng**: Tăng khả năng dự đoán thành công dựa trên timing, như phim ra mắt vào kỳ nghỉ có thể bán vé tốt hơn.

### Bước 3: Nhóm runtime và tạo runtime_hours
- **Đã làm gì**: Tìm cột runtime, tạo `runtime_minutes`, `runtime_hours`, và nhóm thành 5 loại: '< 1 hour', '1-1.5 hours', etc.
- **Công dụng**: Phân loại thời lượng phim để dễ xử lý categorical.
- **Tác dụng**: Hầu hết phim (642) trong '1.5-2 hours', giúp mô hình phân biệt phim ngắn/dài.
- **Ảnh hưởng**: Giúp dự đoán thành công dựa trên độ dài, như phim quá ngắn hoặc quá dài có thể kém hấp dẫn.

### Bước 4: Đếm số diễn viên chính từ cột Stars
- **Đã làm gì**: Xử lý cột `Stars` (danh sách diễn viên), đếm số lượng bằng cách parse string/list.
- **Công dụng**: Tạo đặc trưng `num_main_cast` để đo lường sức hút từ cast.
- **Tác dụng**: Thêm cột số nguyên, xử lý robust cho định dạng phức tạp.
- **Ảnh hưởng**: Phim có nhiều diễn viên nổi tiếng thường thành công hơn, cải thiện accuracy của mô hình.

### Bước 5: Chuẩn hóa Genres - tách, đếm, one-hot cho top N
- **Đã làm gì**: Parse `Genres` thành list, đếm `num_genres`, tạo one-hot cho top 15 genres, và `main_genre`.
- **Công dụng**: Chuyển genres thành đặc trưng numerical cho ML.
- **Tác dụng**: Thêm 15 cột one-hot (vd: `genre_Action`), top genres như Action, Adventure.
- **Ảnh hưởng**: Giúp mô hình học sở thích khán giả theo thể loại, tăng precision trong dự đoán.

### Bước 6: Chuẩn hóa Country - tách, đếm, one-hot cho top N
- **Đã làm gì**: Parse `Production Countries`, lấy quốc gia đầu tiên, nhóm top 10, tạo one-hot và flag `is_usa`.
- **Công dụng**: Xử lý quốc gia sản xuất thành đặc trưng.
- **Tác dụng**: Top countries: USA, UK, Canada, Vietnam, etc.; thêm cột như `is_united_states_of_america`.
- **Ảnh hưởng**: Phim từ USA thường thành công hơn, giúp mô hình capture yếu tố địa lý.

### Bước 7: Xử lý các đặc trưng số (log-transform, ROI check)
- **Đã làm gì**: Log-transform `Budget`/`Revenue`, tính `roi` nếu thiếu, clip `roi_clipped` tại 99%.
- **Công dụng**: Chuẩn hóa phân bố lệch, giảm outlier.
- **Tác dụng**: Thêm `Budget_log`, `Revenue_log`, `roi_clipped`.
- **Ảnh hưởng**: Giúp mô hình học tốt hơn từ dữ liệu số, tránh bias từ giá trị cực lớn.

### Bước 8: Tạo đặc trưng kết hợp (nếu hợp lý)
- **Đã làm gì**: Tạo `budget_per_year`, `roi_vs_vote`, `cast_genre_interaction`.
- **Công dụng**: Capture tương tác giữa đặc trưng.
- **Tác dụng**: Đặc trưng mới như budget điều chỉnh theo năm.
- **Ảnh hưởng**: Tăng độ phức tạp của mô hình, cải thiện dự đoán cho mối quan hệ phi tuyến.

### Bước 9: Lập danh sách đặc trưng cuối cùng và kiểm tra nhanh
- **Đã làm gì**: Thu thập tất cả features vào list, kiểm tra missing values.
- **Công dụng**: Chuẩn bị cho modeling, đảm bảo chất lượng.
- **Tác dụng**: Danh sách 40+ features, báo cáo missing.
- **Ảnh hưởng**: Đảm bảo mô hình dùng dữ liệu đầy đủ, giảm overfitting.

### Bước 10: Lưu dữ liệu features đã xử lý
- **Đã làm gì**: Xuất DataFrame ra `clean_movies_features.csv`.
- **Công dụng**: Lưu output cho tuần 5.
- **Tác dụng**: File CSV với 1020 hàng, nhiều cột features.
- **Ảnh hưởng**: Cung cấp input sạch cho modeling, đảm bảo reproducibility.

### Bước 11: Một vài biểu đồ kiểm tra nhanh
- **Đã làm gì**: Vẽ countplot cho runtime_group, genres, countries, hist cho ROI.
- **Công dụng**: Visualize phân bố để kiểm tra dữ liệu.
- **Tác dụng**: Biểu đồ cho thấy pattern như genres phổ biến, ROI phân bố.
- **Ảnh hưởng**: Phát hiện vấn đề sớm, đảm bảo features hợp lý trước modeling. 
