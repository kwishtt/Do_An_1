# Tuần 6 — Mô hình chính & Feature Importance

Mục tiêu
- Huấn luyện mô hình mạnh hơn và xác định yếu tố ảnh hưởng chính.

Việc cần làm
- Huấn luyện Random Forest (hoặc model tương đương), thử một vài tham số cơ bản.
- Xuất danh sách top 10 đặc trưng quan trọng.
- So sánh hiệu năng với model baseline.

Giao nộp
- Kết quả model chính và danh sách các yếu tố quan trọng.

Checklist
- [ ] Huấn luyện Random Forest
- [ ] Trích feature importance
- [ ] So sánh với baseline

# MỤC TIÊU TUẦN 6

- QUAN TRỌNG: Tìm hiểu Random Forest và cách nó cải thiện so với Logistic Regression. 
- HIỂU RÕ: Cách trích xuất và giải thích feature importance từ mô hình. 
- ỨNG DỤNG: Áp dụng kiến thức này để cải thiện mô hình dự đoán của bạn trong các tuần tiếp theo.

---

## � TÓM TẮT TIẾN ĐỘ 5 TUẦN TRƯỚC

### ✅ **Tuần 1 - Khởi động & Thu thập dữ liệu**
- Lấy dataset `Movies.csv` gốc với thông tin phim quốc tế và Việt Nam
- Xác định tiêu chí "thành công" cho phim (ROI + Vote Average)
- Thiết lập cấu trúc project và workflow Git

### ✅ **Tuần 2 - Làm sạch dữ liệu**
- Xử lý missing values và outliers trong Budget/Revenue
- Chuẩn hóa định dạng Release Date và các cột text
- Tạo `clean_movies.csv` với 1020 phim chất lượng

### ✅ **Tuần 3 - Tạo nhãn & EDA**
- Định nghĩa nhãn `Success` dựa trên ROI ≥ 1 và Vote Average ≥ 6.5
- Phân tích phân phối dữ liệu: tỷ lệ thành công, genre phổ biến
- Tạo `clean_movies_with_labels.csv` với target variable

### ✅ **Tuần 4 - Feature Engineering**  
- Tạo 47 features từ dữ liệu gốc:
  - Time features: `release_year`, `release_month`, `release_quarter`
  - Financial features: `roi`, `roi_clipped`, `budget_per_year` 
  - Content features: `num_genres`, `num_main_cast`, genre dummies
  - Engineered features: `roi_vs_vote`, `cast_genre_interaction`
- Output: `clean_movies_features.csv` (1020 rows × 65 columns)

### ✅ **Tuần 5 - Baseline Modeling**
- **Data preparation**: Train/test split 80/20, Min-Max scaling, stratified sampling
- **Logistic Regression baseline**: Accuracy 84.80%, F1-Score 84.88%
- **Random Forest model**: Accuracy 99.51%, F1-Score 99.51% 
- **Cross-validation**: 5-fold CV xác nhận Random Forest ổn định (std 0.0072)
- **Feature importance**: Top 3 features quan trọng nhất:
  1. `Vote Average` (41.56%) - Chất lượng phim
  2. `roi_vs_vote` (10.70%) - Tương quan ROI và đánh giá  
  3. `roi` (7.05%) - Lợi nhuận thuần
- **Model selection**: Chọn Random Forest làm final model

### 🎯 **Kết quả hiện tại**: 
- Dataset: 1020 phim, 47 features, balanced classes
- Best model: Random Forest (99.51% accuracy)
- Insights: Vote Average là yếu tố quyết định thành công phim nhất

---

## �📋 TODO LIST CHI TIẾT TUẦN 6

### 🎯 BƯỚC 1: Tối Ưu Hóa Random Forest Model
**Mục đích**: Cải thiện hiệu suất và tránh overfitting
**Thời gian**: 2-3 giờ

#### 1.1 Hyperparameter Tuning
- [x] Tạo file `hyperparameter_tuning.py` trong `progress/week06/`
- [x] Thử nghiệm các tham số:
  - `n_estimators`: [50, 100, 200, 300]
  - `max_depth`: [5, 10, 15, 20, None]
  - `min_samples_split`: [2, 5, 10]
  - `min_samples_leaf`: [1, 2, 4]
- [x] Sử dụng GridSearchCV hoặc RandomizedSearchCV
- [x] So sánh với model hiện tại (accuracy 99.51%)
- [x] Lưu best model vào `optimized_rf_model.pkl`

#### 1.2 Kiểm Tra Overfitting
- [x] Tạo learning curves để visualize train vs validation performance
- [x] Phân tích train accuracy vs test accuracy gap
- [x] Nếu overfit: giảm `max_depth`, tăng `min_samples_split`
- [x] Ghi kết quả vào `overfitting_analysis.txt`

### 🔍 BƯỚC 2: Phân Tích Feature Importance Sâu Hơn
**Mục đích**: Hiểu rõ yếu tố nào ảnh hưởng đến thành công phim
**Thời gian**: 2 giờ

#### 2.1 Visualize Feature Importance
- [ ] Tạo file `feature_analysis.py` 
- [ ] Vẽ bar chart top 15 features quan trọng nhất
- [ ] Tạo heatmap correlation giữa top features và target
- [ ] So sánh importance giữa features gốc vs engineered features
- [ ] Lưu charts vào folder `charts/week06/`

#### 2.2 Business Insights từ Features
- [ ] Phân tích ý nghĩa thực tế của top 10 features:
  - `Vote Average` (41.56%): Chất lượng phim quan trọng nhất
  - `roi_vs_vote` (10.70%): Tương quan ROI và đánh giá
  - `roi` (7.05%): Lợi nhuận thuần
- [ ] Liên kết với domain knowledge về ngành phim
- [ ] Viết insights vào `business_insights.md`

### 📊 BƯỚC 3: So Sánh Với Model Baseline Chi Tiết
**Mục đích**: Chứng minh Random Forest vượt trội
**Thời gian**: 1-2 giờ

#### 3.1 Comprehensive Comparison
- [ ] Tạo file `model_comparison.py`
- [ ] So sánh nhiều metrics:
  - Accuracy, Precision, Recall, F1-Score
  - AUC-ROC curve 
  - Precision-Recall curve
  - Training time
- [ ] Tạo comparison table và visualization
- [ ] Phân tích khi nào nên dùng Random Forest vs Logistic Regression

#### 3.2 Error Analysis Between Models
- [ ] So sánh confusion matrix của cả 2 models
- [ ] Phân tích cases mà Random Forest predict đúng nhưng Logistic sai
- [ ] Tìm pattern trong misclassified examples
- [ ] Lưu kết quả vào `detailed_comparison.txt`

### 🎬 BƯỚC 4: Domain-Specific Analysis
**Mục đính**: Áp dụng hiểu biết về ngành phim
**Thời gian**: 1-2 giờ

#### 4.1 Genre Success Analysis
- [ ] Phân tích success rate theo từng genre
- [ ] Xem genre nào có ROI cao nhất
- [ ] Liên kết với feature importance (ví dụ: tại sao Comedy quan trọng)
- [ ] Tạo insights cho nhà sản xuất phim

#### 4.2 Vietnam vs International Movie Analysis  
- [ ] So sánh success pattern giữa phim Việt và nước ngoài
- [ ] Phân tích features quan trọng riêng cho phim Việt
- [ ] Đề xuất strategy cho ngành phim Việt

### 📝 BƯỚC 5: Documentation và Báo Cáo
**Mục đích**: Ghi lại kết quả và chuẩn bị cho tuần sau
**Thời gian**: 1 giờ

#### 5.1 Update Week 6 Report
- [ ] Viết báo cáo chi tiết trong `w06.md`
- [ ] Include tất cả findings, charts, insights
- [ ] Liên kết với business value

#### 5.2 Prepare for Week 7
- [ ] Identify potential issues cho tuần 7 (class imbalance handling)
- [ ] Chuẩn bị data và model cho error analysis tuần sau
- [ ] Update project README với week 6 progress

---

## 🎯 TIÊU CHÍ THÀNH CÔNG TUẦN 6

✅ **Model Performance**: Optimized Random Forest với hiệu suất tốt hơn baseline
✅ **Feature Understanding**: Clear insights về top 10 features quan trọng nhất  
✅ **Business Value**: Practical recommendations cho ngành phim
✅ **Documentation**: Complete báo cáo với charts và analysis
✅ **Reproducibility**: Code chạy được và results có thể replicate

---

## 💡 TIPS QUAN TRỌNG

1. **Overfitting Check**: Nếu accuracy quá cao (99%+), có thể model đang overfit
2. **Feature Selection**: Có thể remove features với importance < 1%
3. **Validation Strategy**: Dùng stratified k-fold cho data không cân bằng
4. **Business Context**: Luôn liên kết technical findings với thực tế ngành phim
5. **Documentation**: Ghi chú tất cả experiments để không bị lặp lại

---

## 📊 KẾT QUẢ BƯỚC 1 - TỐI ƯU HÓA RANDOM FOREST MODEL ✅

### ✅ **Bước 1.1: Hyperparameter Tuning - HOÀN THÀNH**
**Kết quả chính:**
- **Best Parameters tìm được:**
  - `n_estimators`: 100 (optimal)
  - `max_depth`: 5 (tránh overfitting) 
  - `min_samples_split`: 2
  - `min_samples_leaf`: 1
  - `max_features`: None
- **Performance:** F1-Score 99.52% (bằng baseline)
- **CV Score:** 99.88% (rất ổn định)
- **Thời gian tuning:** 49.78 giây
- **Kết luận:** Model baseline đã optimal, không cần điều chỉnh

### ✅ **Bước 1.2: Overfitting Analysis - HOÀN THÀNH**
**Kết quả phân tích:**
- **Train vs Test Gap:** 
  - Accuracy gap: 0.49% (rất thấp)
  - F1 gap: 0.48% (rất thấp)
- **Overfitting Status:** No Significant Overfitting ✅
- **Recommendation:** Model ổn định, có thể sử dụng
- **Learning Curves:** Đã tạo và phân tích chi tiết
- **Optimal Training Size:** 652 samples

**📁 Files đã tạo:**
- `progress/week06/hyperparameter_tuning.py` + `hyperparameter_tuning_results.txt`
- `progress/week06/overfitting_analysis.py` + `overfitting_analysis.txt`  
- `chart/week06/overfitting_analysis.png` (Learning curves)
- `data/pkl/optimized_rf_model.pkl` (Best model)

**🎯 Insights quan trọng:**
1. **Model baseline đã rất tốt** - Hyperparameter tuning không cải thiện thêm
2. **Không có overfitting** - Gap train-test chỉ 0.48%
3. **max_depth=5 optimal** - Giúp tránh overfitting mà vẫn giữ performance
4. **Dataset chất lượng cao** - Model học được patterns tốt

---

