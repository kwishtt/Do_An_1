const App={isLoading:false,currentTheme:'light',currentPage:'input',charts:{},formData:{},predictionResult:null,init(){this.setupEventListeners();this.setupTwoPageFlow();this.updateDashboardPreview();console.log('FilmPredict App initialized successfully');},setupTwoPageFlow(){this.showPage('input');const backBtn=document.getElementById('back-to-form');if (backBtn){backBtn.addEventListener('click',()=>this.showPage('input'));}const tryAgainBtn=document.getElementById('try-again-btn');if (tryAgainBtn){tryAgainBtn.addEventListener('click',()=>{this.showPage('input');const form=document.getElementById('prediction-form');if (form)form.reset();document.querySelectorAll('.genre-chip.active').forEach(chip=>{chip.classList.remove('active');});document.getElementById('genres').value='';});}},showPage(pageType){const inputPage=document.getElementById('input-page');const resultsPage=document.getElementById('results-page');if (pageType==='input'){if (inputPage)inputPage.classList.add('active');if (resultsPage)resultsPage.classList.remove('active');this.currentPage='input';this.updateProgressIndicator('input');setTimeout(()=>{window.scrollTo({top:0,behavior:'smooth'});},100);}else if (pageType==='results'){if (inputPage)inputPage.classList.remove('active');if (resultsPage){resultsPage.classList.add('active');}this.currentPage='results';this.updateProgressIndicator('results');}},updateProgressIndicator(activePage){const inputSteps=document.querySelectorAll('.progress-indicator .step:first-child');const resultsSteps=document.querySelectorAll('.progress-indicator .step:last-child');if (activePage==='input'){inputSteps.forEach(step=>{step.className='step active';const icon=step.querySelector('i');if (icon){icon.className='fas fa-edit';}});resultsSteps.forEach(step=>{step.className='step';const icon=step.querySelector('i');if (icon){icon.className='fas fa-chart-line';}});}else if (activePage==='results'){inputSteps.forEach(step=>{step.className='step completed';const icon=step.querySelector('i');if (icon){icon.className='fas fa-check-circle';}});resultsSteps.forEach(step=>{step.className='step active';const icon=step.querySelector('i');if (icon){icon.className='fas fa-chart-line';}});}},setupGenreChips(){const genreChips=document.querySelectorAll('.genre-chip');const genresInput=document.getElementById('genres');const selectedGenres=new Set();genreChips.forEach(chip=>{chip.addEventListener('click',(e)=>{e.preventDefault();const genre=chip.dataset.genre;if (chip.classList.contains('active')){chip.classList.remove('active');selectedGenres.delete(genre);}else {chip.classList.add('active');selectedGenres.add(genre);}if (genresInput){genresInput.value=Array.from(selectedGenres).join(',');}console.log('Selected genres:',Array.from(selectedGenres));});});},setupEventListeners(){this.setupGenreChips();let lastScrollY=0;const header=document.querySelector('.header');window.addEventListener('scroll',()=>{const scrollY=window.scrollY;if (scrollY>50){header.classList.add('scrolled');}else {header.classList.remove('scrolled');}lastScrollY=scrollY;});const predictionForm=document.getElementById('prediction-form');if (predictionForm){predictionForm.addEventListener('submit',(e)=>this.handleFormSubmit(e));}const rangeInputs=document.querySelectorAll('input[type="range"]');rangeInputs.forEach(input=>{input.addEventListener('input',(e)=>this.updateRangeValue(e));});const randomDataBtn=document.getElementById('randomDataBtn');if (randomDataBtn){randomDataBtn.addEventListener('click',(e)=>{e.preventDefault();this.showRandomDataModal();});}const modalCloseBtn=document.getElementById('modal-close-btn');if (modalCloseBtn){modalCloseBtn.addEventListener('click',()=>{this.hideRandomDataModal();});}const testSuccessBtn=document.getElementById('test-success-btn');const testAverageBtn=document.getElementById('test-average-btn');const testFailureBtn=document.getElementById('test-failure-btn');if (testSuccessBtn){testSuccessBtn.addEventListener('click',()=>{this.fillRandomData('success');});}if (testAverageBtn){testAverageBtn.addEventListener('click',()=>{this.fillRandomData('average');});}if (testFailureBtn){testFailureBtn.addEventListener('click',()=>{this.fillRandomData('failure');});}const modal=document.getElementById('random-data-modal');if (modal){modal.addEventListener('click',(e)=>{if (e.target===modal){this.hideRandomDataModal();}});}const budgetInput=document.getElementById('budget');const revenueInput=document.getElementById('revenue');if (budgetInput){budgetInput.addEventListener('input',()=>{console.log('üí∞ Budget updated:',budgetInput.value);});}if (revenueInput){revenueInput.addEventListener('input',()=>{console.log('üíµ Revenue updated:',revenueInput.value);});}document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener('click',(e)=>{e.preventDefault();const target=document.querySelector(anchor.getAttribute('href'));if (target){target.scrollIntoView({behavior:'smooth'});}});});const navToggle=document.getElementById('navToggle');const navMenu=document.querySelector('.nav-menu');if (navToggle && navMenu){navToggle.addEventListener('click',(e)=>{const isOpen=navMenu.classList.toggle('open');if (isOpen){setTimeout(()=>navMenu.classList.add('show'),10);navToggle.setAttribute('aria-expanded','true');}else {navMenu.classList.remove('show');navToggle.setAttribute('aria-expanded','false');}});document.addEventListener('click',(e)=>{if (!e.target.closest('.nav-menu')&& !e.target.closest('#navToggle')){if (navMenu.classList.contains('open')){navMenu.classList.remove('show');setTimeout(()=>navMenu.classList.remove('open'),220);navToggle.setAttribute('aria-expanded','false');}}});}this.setupScrollAnimations();},setupScrollAnimations(){const observer=new IntersectionObserver((entries)=>{entries.forEach(entry=>{if (entry.isIntersecting){entry.target.classList.add('fade-in');}});},{threshold:0.1});document.querySelectorAll('.feature-card,.step-card,.chart-card').forEach(el=>{observer.observe(el);});},updateRangeValue(event){const input=event.target;const valueDisplay=input.parentElement.querySelector('.range-value');if (valueDisplay){const value=parseFloat(input.value);if (input.id==='budget'){valueDisplay.textContent=`${value}t·ª∑`;}else if (input.id==='runtime'){valueDisplay.textContent=`${value}ph√∫t`;}else if (input.id==='vote_average'){valueDisplay.textContent=value.toFixed(1);}else if (input.id==='vote_count'){valueDisplay.textContent=this.formatNumber(value);}else {valueDisplay.textContent=value;}}},formatNumber(num){if (num>=1000){return (num/1000).toFixed(0)+'K';}return num.toString();},formatCurrency(amount){if (amount>=1000000){return `$${(amount/1000000).toFixed(1)}M`;}else if (amount>=1000){return `$${(amount/1000).toFixed(0)}K`;}else {return `$${amount}`;}},async handleFormSubmit(event){event.preventDefault();if (this.isLoading)return;try{this.showLoading();const formData=new FormData(event.target);const data=this.processFormData(formData);if (!this.validateFormData(data)){throw new Error('D·ªØ li·ªáu kh√¥ng h·ª£p l·ªá. Vui l√≤ng ki·ªÉm tra l·∫°i.');}const result=await this.makePrediction(data);this.displayPredictionResult(result);this.updateChartsWithPrediction(result);this.showPage('results');this.showResultsLoading();setTimeout(()=>{const predictionHero=document.querySelector('.prediction-hero');if (predictionHero){predictionHero.scrollIntoView({behavior:'smooth',block:'center'});}setTimeout(()=>{this.hideResultsLoading();},1500);},300);}catch(error){console.error('Prediction error:',error);this.showError(error.message || 'C√≥ l·ªói x·∫£y ra khi d·ª± ƒëo√°n. Vui l√≤ng th·ª≠ l·∫°i.');}finally{this.hideLoading();}},processFormData(formData){const data={};data.title=formData.get('title')|| 'Untitled Movie';data.budget=parseFloat(formData.get('budget'))|| 0;data.revenue=parseFloat(formData.get('revenue'))|| 0;data.runtime=parseInt(formData.get('runtime'))|| 90;data.voteAverage=parseFloat(formData.get('vote_average'))|| 5.0;data.voteCount=parseInt(formData.get('vote_count'))|| 5000;data.releaseMonth=parseInt(formData.get('release_month'))|| 1;const genresInput=document.getElementById('genres');if (genresInput && genresInput.value){data.genres=genresInput.value.split(',').filter(g=>g.trim());}else {data.genres=[];}data.productionCompanies=[];data.countries=['Vietnam'];data.languages=['Vietnamese'];return data;},validateFormData(data){const errors=[];if (!data.title || data.title.trim()===''){errors.push('T√™n phim kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng');}if (data.budget<=0){errors.push('Ng√¢n s√°ch ph·∫£i l·ªõn h∆°n 0');}else if (data.budget>1000000000){errors.push('Ng√¢n s√°ch v∆∞·ª£t qu√° gi·ªõi h·∫°n h·ª£p l√Ω(1 t·ª∑ USD)');}if (data.revenue<=0){errors.push('Doanh thu ph·∫£i l·ªõn h∆°n 0');}else if (data.revenue>5000000000){errors.push('Doanh thu v∆∞·ª£t qu√° gi·ªõi h·∫°n h·ª£p l√Ω(5 t·ª∑ USD)');}if (data.runtime<30){errors.push('Th·ªùi l∆∞·ª£ng phim ph·∫£i √≠t nh·∫•t 30 ph√∫t');}else if (data.runtime>300){errors.push('Th·ªùi l∆∞·ª£ng phim kh√¥ng n√™n qu√° 300 ph√∫t(5 gi·ªù)');}if (data.voteAverage<0 || data.voteAverage>10){errors.push('ƒêi·ªÉm ƒë√°nh gi√° ph·∫£i t·ª´ 0 ƒë·∫øn 10');}else if (data.voteAverage<3){errors.push('C·∫£nh b√°o:ƒêi·ªÉm ƒë√°nh gi√° d∆∞·ªõi 3/10 r·∫•t kh√≥ th√†nh c√¥ng');}if (data.genres && data.genres.length>5){errors.push('Kh√¥ng n√™n ch·ªçn qu√° 5 th·ªÉ lo·∫°i');}if (errors.length>0){this.showValidationErrors(errors);return false;}return true;},showValidationErrors(errors){const errorHtml=`<div class="validation-errors"><h3>‚ö†Ô∏è Vui l√≤ng ki·ªÉm tra l·∫°i:</h3><ul>${errors.map(err=>`<li>${err}</li>`).join('')}</ul></div>`;this.showError(errorHtml);},async makePrediction(data){try{const response=await fetch('/predict',{method:'POST',headers:{'Content-Type':'application/json',},body:JSON.stringify(data)});if (!response.ok){const errorData=await response.json();throw new Error(errorData.error || 'L·ªói khi g·ªçi API d·ª± ƒëo√°n');}const result=await response.json();const actualConfidence=Math.round(result.prediction.success_probability*100*100)/100;console.log('‚úÖ API Response Success:',{success_probability:result.prediction.success_probability,actualConfidence:actualConfidence,will_succeed:result.prediction.will_succeed,is_real_model:result.model_info?.is_real_model});return{success:result.prediction.will_succeed,confidence:actualConfidence,success_probability:result.prediction.success_probability,data:result.input_data,timestamp:new Date(result.model_info.prediction_timestamp),metrics:result.metrics,model_info:result.model_info,is_real_model:result.model_info.is_real_model || false,model_accuracy:result.model_info?.accuracy || 0.9952,model_features:result.model_info?.features_count || 47};}catch(error){console.error('‚ùå API call failed:',error);console.warn('‚ö†Ô∏è FALLBACK:Using mock prediction(API failed)');await new Promise(resolve=>setTimeout(resolve,1000));const success=this.calculateMockPrediction(data);const mockConfidence=this.calculateConfidence(data);console.log('‚ö†Ô∏è Mock Prediction:',{success,confidence:mockConfidence,is_mock:true});return{success,confidence:mockConfidence,data,timestamp:new Date(),metrics:this.generateMockMetrics(data,success),is_mock:true};}},calculateMockPrediction(data){let score=0;const voteAverage=parseFloat(data.voteAverage)|| 6.5;if (voteAverage>=8.5)score+=75;else if (voteAverage>=8.0)score+=65;else if (voteAverage>=7.5)score+=55;else if (voteAverage>=7.0)score+=45;else if (voteAverage>=6.5)score+=30;else if (voteAverage>=6.0)score+=15;else if (voteAverage>=5.5)score+=5;else score-=10;const budget=parseFloat(data.budget)|| 0;const revenue=parseFloat(data.revenue)|| 0;if (revenue>0 && budget>0){const roi=revenue/budget;if (roi>=3.0)score+=23;else if (roi>=2.0)score+=18;else if (roi>=1.5)score+=15;else if (roi>=1.2)score+=10;else if (roi>=1.0)score+=5;else if (roi>=0.8)score+=2;else score-=5;}else if (budget>0){if (budget>=200000000)score+=5;else if (budget>=100000000)score+=3;else if (budget>=50000000)score+=2;else if (budget>=10000000)score+=1;}const runtime=parseInt(data.runtime)|| 120;if (runtime>=90 && runtime<=150)score+=1;else if (runtime>180)score-=1;else if (runtime<80)score-=1;const randomFactor=(Math.random()-0.5)*10;score+=randomFactor;return score>=50;},calculateConfidence(data){let confidence=60;const voteAverage=parseFloat(data.voteAverage)|| 6.5;if (voteAverage>=8.5){confidence+=25;}else if (voteAverage>=8.0){confidence+=22;}else if (voteAverage>=7.5){confidence+=18;}else if (voteAverage>=7.0){confidence+=15;}else if (voteAverage>=6.5){confidence+=10;}else if (voteAverage>=6.0){confidence+=5;}else if (voteAverage<5.0){confidence-=8;}if (data.budget>0)confidence+=8;if (data.revenue>0)confidence+=12;if (data.runtime && data.runtime>0)confidence+=4;if (data.genres && data.genres.length>0)confidence+=3;if (data.budget>=1000000 && data.budget<=500000000)confidence+=6;if (data.voteAverage>=1.0 && data.voteAverage<=10.0)confidence+=4;if (data.runtime>=60 && data.runtime<=200)confidence+=5;if (data.revenue>0 && data.budget>0){const roi=data.revenue/data.budget;if (roi>=0.5 && roi<=10.0){confidence+=12;}else if (roi>0){confidence+=6;}}try{const month=parseInt(data.releaseMonth)|| new Date().getMonth()+1;if ([6,7,12].includes(month)){confidence+=3;}}catch(e){}const hasBothKeyFactors=voteAverage>=6.5 && data.budget>0 && data.revenue>0;if (hasBothKeyFactors){confidence+=8;}confidence+=(Math.random()-0.5)*3;return Math.max(62,Math.min(96,Math.round(confidence)));},generateMockMetrics(data,success){const voteAverage=parseFloat(data.voteAverage)|| 6.5;const budget=parseFloat(data.budget)|| 50000000;let baseROI;if (voteAverage>=8.5){baseROI=3.5+Math.random()*3;}else if (voteAverage>=8.0){baseROI=2.8+Math.random()*2;}else if (voteAverage>=7.5){baseROI=2.0+Math.random()*1.5;}else if (voteAverage>=7.0){baseROI=1.5+Math.random()*1;}else if (voteAverage>=6.5){baseROI=1.2+Math.random()*0.8;}else if (voteAverage>=6.0){baseROI=0.8+Math.random()*0.6;}else if (voteAverage>=5.5){baseROI=0.5+Math.random()*0.5;}else {baseROI=0.2+Math.random()*0.5;}if (budget>=100000000){baseROI*=(0.7+Math.random()*0.3);}else if (budget<=10000000){baseROI*=(1.1+Math.random()*0.4);}else {baseROI*=(0.9+Math.random()*0.3);}const predictedRevenue=budget*baseROI;return{predictedROI:Math.max(0.1,baseROI).toFixed(2),predictedRevenue:Math.round(predictedRevenue),breakEvenPoint:Math.round(budget*1.1),marketPotential:this.calculateMarketPotential(voteAverage,baseROI),riskLevel:this.calculateRiskLevel(voteAverage,baseROI),profitMargin:this.calculateProfitMargin(baseROI),investmentGrade:this.calculateInvestmentGrade(voteAverage,baseROI),competitionLevel:data.voteAverage>=7.5 ? 'C·∫°nh tranh cao':'C·∫°nh tranh v·ª´a',targetAudience:this.analyzeTargetAudience(data),releaseStrategy:this.analyzeReleaseStrategy(data),financialBreakdown:{production:Math.round(budget*0.7),marketing:Math.round(budget*0.3),expectedProfit:Math.round(predictedRevenue-budget),breakEvenDays:this.estimateBreakEvenDays(baseROI,voteAverage)}};},calculateMarketPotential(voteAvg,roi){if (voteAvg>=8.0 && roi>2.0)return 'R·∫•t cao';if (voteAvg>=7.5 && roi>1.5)return 'Cao';if (voteAvg>=7.0 || roi>1.2)return 'Trung b√¨nh cao';if (voteAvg>=6.5 || roi>1.0)return 'Trung b√¨nh';if (roi>0.8)return 'Th·∫•p';return 'R·∫•t th·∫•p';},calculateRiskLevel(voteAvg,roi){if (voteAvg>=8.0 && roi>2.5)return 'R·∫•t th·∫•p';if (voteAvg>=7.5 && roi>1.8)return 'Th·∫•p';if (voteAvg>=7.0 && roi>1.2)return 'Trung b√¨nh th·∫•p';if (voteAvg>=6.5 && roi>1.0)return 'Trung b√¨nh';if (voteAvg>=6.0 || roi>0.8)return 'Trung b√¨nh cao';if (roi>0.5)return 'Cao';return 'R·∫•t cao';},calculateProfitMargin(roi){const margin=(roi-1)*100;if (margin>150)return '150%+';if (margin>100)return '100-150%';if (margin>50)return '50-100%';if (margin>20)return '20-50%';if (margin>0)return '0-20%';if (margin>-20)return '-20-0%';return '-20%+';},calculateInvestmentGrade(voteAvg,roi){if (voteAvg>=8.0 && roi>3.0)return 'A+';if (voteAvg>=7.5 && roi>2.0)return 'A';if (voteAvg>=7.0 && roi>1.5)return 'A-';if (voteAvg>=6.8 && roi>1.2)return 'B+';if (voteAvg>=6.5 && roi>1.0)return 'B';if (voteAvg>=6.0 || roi>0.8)return 'B-';if (voteAvg>=5.5 || roi>0.5)return 'C+';if (roi>0.2)return 'C';return 'C-';},estimateBreakEvenDays(roi,voteAvg){if (roi>=3.0)return 8+Math.floor(Math.random()*5);if (roi>=2.0)return 12+Math.floor(Math.random()*8);if (roi>=1.5)return 18+Math.floor(Math.random()*12);if (roi>=1.0)return 25+Math.floor(Math.random()*15);if (roi>=0.7)return 35+Math.floor(Math.random()*25);return 50+Math.floor(Math.random()*40);},analyzeTargetAudience(data){if (data.voteAverage>=8.5)return 'Kh√°n gi·∫£ cao c·∫•p,y√™u th√≠ch ch·∫•t l∆∞·ª£ng üé≠';if (data.voteAverage>=8.0)return 'Kh√°n gi·∫£ ƒë·∫°i ch√∫ng,gia ƒë√¨nh th√≠ch phim ch·∫•t l∆∞·ª£ng üë®‚Äçüë©‚Äçüëß';if (data.voteAverage>=7.0)return 'Kh√°n gi·∫£ ƒë·∫°i ch√∫ng,gia ƒë√¨nh üé¨';if (data.voteAverage>=6.0)return 'Kh√°n gi·∫£ tr·∫ª,gi·∫£i tr√≠ nh·∫π üéâ';return 'Kh√°n gi·∫£ th√≠ch th·ªÉ lo·∫°i ƒë·∫∑c bi·ªát üéØ';},analyzeReleaseStrategy(data){const month=data.releaseMonth;if ([6,7,12].includes(month))return 'M√πa phim bom t·∫•n-C·∫°nh tranh cao üí•';if ([3,4,9,10].includes(month))return 'M√πa v√†ng-Thu·∫≠n l·ª£i ph√°t h√†nh ‚≠ê';return 'M√πa th·∫•p ƒëi·ªÉm-√çt c·∫°nh tranh üé™';},displayPredictionResult(result){this.predictionResult=result;this.updateModelStatusWarning(result);const resultMovieTitle=document.getElementById('result-movie-title');if (resultMovieTitle){resultMovieTitle.textContent=result.data.title;}const predictionBadge=document.querySelector('.prediction-badge');if (predictionBadge){predictionBadge.innerHTML=`<i class="fas fa-${result.success ? 'check-circle':'times-circle'}"></i><span class="badge-text">${result.success ? 'TH√ÄNH C√îNG':'TH·∫§T B·∫†I'}</span>`;predictionBadge.className=`prediction-badge ${result.success ? 'success':'failure'}`;}this.updateConfidenceGauge(result.confidence);this.updateCompactMetrics(result.metrics,result.data);this.updateFeatureImportanceDisplay(result);this.updateBusinessInsights(result.metrics);console.log('Full-screen prediction result displayed:',result);},updateCompactMetrics(metrics,data){const predictedROI=parseFloat(metrics.predictedROI)|| 0;const predictedRevenue=parseFloat(metrics.predictedRevenue)|| 0;this.updateMetricValue('predicted-roi-compact',`${predictedROI.toFixed(2)}x`);this.updateMetricValue('predicted-revenue-compact',`${(predictedRevenue/1000000000).toFixed(4)}t·ª∑`);this.updateMetricValue('risk-level-compact',metrics.riskLevel || 'N/A');this.updateMetricValue('market-potential-compact',metrics.marketPotential || 'N/A');this.applyMetricColors();},applyMetricColors(){const metrics=this.predictionResult?.metrics;if (!metrics)return;const roiElement=document.getElementById('predicted-roi-compact');if (roiElement){const roi=parseFloat(metrics.predictedROI)|| 0;if (roi>1.5){roiElement.className='metric-value-compact success';}else if (roi>1.0){roiElement.className='metric-value-compact warning';}else {roiElement.className='metric-value-compact danger';}}const riskElement=document.getElementById('risk-level-compact');if (riskElement){const risk=metrics.riskLevel;if (risk==='Th·∫•p' || risk==='R·∫•t th·∫•p'){riskElement.className='metric-value-compact success';}else if (risk==='Trung b√¨nh'){riskElement.className='metric-value-compact warning';}else {riskElement.className='metric-value-compact danger';}}const potentialElement=document.getElementById('market-potential-compact');if (potentialElement){const potential=metrics.marketPotential;if (potential==='Cao' || potential==='R·∫•t cao'){potentialElement.className='metric-value-compact success';}else if (potential==='Trung b√¨nh' || potential==='Trung b√¨nh cao'){potentialElement.className='metric-value-compact warning';}else {potentialElement.className='metric-value-compact danger';}}},updateFeatureImportanceDisplay(result){const container=document.getElementById('feature-importance-display');if (!container)return;const features=result.model_info?.feature_importance?.top_features ||(result.feature_importance ? result.feature_importance.top_features:[]);if (features.length>0){const featuresHtml=features.slice(0,8).map(feature=>`<div class="feature-item"><span class="feature-name">${feature.name}</span><span class="feature-importance">${feature.importance}%</span></div>`).join('');const metrics=result.metrics ||{};const data=result.data ||{};let adviceTitle='G·ª£i √Ω h√†nh ƒë·ªông';let adviceLines=[];const risk=(metrics.riskLevel || '').toLowerCase();if (risk.includes('r·∫•t th·∫•p')|| risk.includes('th·∫•p')){adviceLines.push('R·ªßi ro th·∫•p ‚Üí TƒÉng ƒë·∫ßu t∆∞ cho marketing ƒë·ªÉ t·ªëi ƒëa ho√° l·ª£i nhu·∫≠n.');}else if (risk.includes('trung b√¨nh')){adviceLines.push('R·ªßi ro trung b√¨nh ‚Üí T·∫≠p trung t·ªëi ∆∞u marketing v√† ph√¢n ph·ªëi,th·ª≠ A/B k√™nh qu·∫£ng c√°o.');}else if (risk.includes('cao')){adviceLines.push('R·ªßi ro cao ‚Üí Gi·∫£m quy m√¥ chi ti√™u,c·ªßng c·ªë ch·∫•t l∆∞·ª£ng(k·ªãch b·∫£n,di·ªÖn xu·∫•t),r·ªìi t√°i kh·ªüi ƒë·ªông chi·∫øn d·ªãch.');}else {adviceLines.push('Kh√¥ng ƒë·ªß d·ªØ li·ªáu r·ªßi ro ‚Äî ki·ªÉm tra l·∫°i th√¥ng tin ƒë·∫ßu v√†o(budget,revenue,voteAverage).');}const roi=parseFloat(metrics.predictedROI)|| 0;if (roi>1.5){adviceLines.push('ROI d·ª± ki·∫øn cao ‚Üí ∆Øu ti√™n m·ªü r·ªông ph√¢n ph·ªëi t·∫°i nhi·ªÅu r·∫°p v√† th·ªã tr∆∞·ªùng.');}else if (roi>1.0){adviceLines.push('ROI ·ªïn ‚Üí T·ªëi ∆∞u chi ph√≠ marketing,t·∫≠p trung k√™nh c√≥ hi·ªáu su·∫•t cao.');}else {adviceLines.push('ROI th·∫•p ‚Üí C√¢n nh·∫Øc gi·∫£m chi ph√≠ ho·∫∑c thay ƒë·ªïi chi·∫øn l∆∞·ª£c ph√°t h√†nh.');}const voteAvg=parseFloat(data.vote_average || data.voteAverage || 0);if (voteAvg && voteAvg<6.5){adviceLines.push('ƒêi·ªÉm ƒë√°nh gi√° th·∫•p ‚Üí ƒê·∫ßu t∆∞ c·∫£i thi·ªán ch·∫•t l∆∞·ª£ng(k·ªãch b·∫£n,h·∫≠u k·ª≥,PR chuy√™n s√¢u).');}else if (voteAvg && voteAvg>=8.0){adviceLines.push('ƒêi·ªÉm ƒë√°nh gi√° cao ‚Üí Khai th√°c PR & review,ƒë·∫©y tie-in v·ªõi influencers ƒë·ªÉ tƒÉng v√©.');}const adviceHtml=`<div class="feature-advice"><div class="advice-header"><strong>${adviceTitle}</strong><span class="advice-sub">D·ª±a tr√™n ph√¢n t√≠ch m√¥ h√¨nh hi·ªán th·ªùi</span></div><ul class="advice-list">${adviceLines.map(line=>`<li>${line}</li>`).join('')}</ul></div>`;container.innerHTML=`<div class="feature-advice-and-list"><div class="feature-list">${featuresHtml}</div><div class="advice-side">${adviceHtml}</div></div>`;}else {const metrics=result.metrics ||{};const data=result.data ||{};let adviceTitle='G·ª£i √Ω h√†nh ƒë·ªông';let adviceLines=[];const risk=(metrics.riskLevel || '').toLowerCase();if (risk.includes('r·∫•t th·∫•p')|| risk.includes('th·∫•p')){adviceLines.push('R·ªßi ro th·∫•p ‚Üí TƒÉng ƒë·∫ßu t∆∞ cho marketing ƒë·ªÉ t·ªëi ƒëa ho√° l·ª£i nhu·∫≠n.');}else if (risk.includes('trung b√¨nh')){adviceLines.push('R·ªßi ro trung b√¨nh ‚Üí T·∫≠p trung t·ªëi ∆∞u marketing v√† ph√¢n ph·ªëi,th·ª≠ A/B k√™nh qu·∫£ng c√°o.');}else if (risk.includes('cao')){adviceLines.push('R·ªßi ro cao ‚Üí Gi·∫£m quy m√¥ chi ti√™u,c·ªßng c·ªë ch·∫•t l∆∞·ª£ng(k·ªãch b·∫£n,di·ªÖn xu·∫•t),r·ªìi t√°i kh·ªüi ƒë·ªông chi·∫øn d·ªãch.');}else {adviceLines.push('Kh√¥ng ƒë·ªß d·ªØ li·ªáu r·ªßi ro ‚Äî ki·ªÉm tra l·∫°i th√¥ng tin ƒë·∫ßu v√†o(budget,revenue,voteAverage).');}const roi=parseFloat(metrics.predictedROI)|| 0;if (roi>1.5){adviceLines.push('ROI d·ª± ki·∫øn cao ‚Üí ∆Øu ti√™n m·ªü r·ªông ph√¢n ph·ªëi t·∫°i nhi·ªÅu r·∫°p v√† th·ªã tr∆∞·ªùng.');}else if (roi>1.0){adviceLines.push('ROI ·ªïn ‚Üí T·ªëi ∆∞u chi ph√≠ marketing,t·∫≠p trung k√™nh c√≥ hi·ªáu su·∫•t cao.');}else {adviceLines.push('ROI th·∫•p ‚Üí C√¢n nh·∫Øc gi·∫£m chi ph√≠ ho·∫∑c thay ƒë·ªïi chi·∫øn l∆∞·ª£c ph√°t h√†nh.');}const voteAvg=parseFloat(data.vote_average || data.voteAverage || 0);if (voteAvg && voteAvg<6.5){adviceLines.push('ƒêi·ªÉm ƒë√°nh gi√° th·∫•p ‚Üí ƒê·∫ßu t∆∞ c·∫£i thi·ªán ch·∫•t l∆∞·ª£ng(k·ªãch b·∫£n,h·∫≠u k·ª≥,PR chuy√™n s√¢u).');}else if (voteAvg && voteAvg>=8.0){adviceLines.push('ƒêi·ªÉm ƒë√°nh gi√° cao ‚Üí Khai th√°c PR & review,ƒë·∫©y tie-in v·ªõi influencers ƒë·ªÉ tƒÉng v√©.');}const adviceHtml=`<div class="feature-advice"><div class="advice-header"><strong>${adviceTitle}</strong><span class="advice-sub">D·ª±a tr√™n ph√¢n t√≠ch m√¥ h√¨nh hi·ªán th·ªùi</span></div><ul class="advice-list">${adviceLines.map(line=>`<li>${line}</li>`).join('')}</ul></div>`;container.innerHTML=adviceHtml;}},updateBusinessInsights(metrics){this.updateMetricValue('target-audience-insight',metrics.targetAudience || 'Kh√°n gi·∫£ ƒë·∫°i ch√∫ng');this.updateMetricValue('release-strategy-insight',metrics.releaseStrategy || 'C·∫ßn ph√¢n t√≠ch th√™m');this.updateMetricValue('investment-grade-insight',metrics.investmentGrade || 'B');this.updateMetricValue('profit-margin-insight',metrics.profitMargin || 'C·∫ßn t√≠nh to√°n');},updateModelStatusWarning(result){const existingWarning=document.querySelector('.model-status-warning,.model-status-success');if (existingWarning){existingWarning.remove();}if (result.is_mock){const warningHtml=`<div class="model-status-warning alert-warning"><i class="fas fa-exclamation-triangle"></i><div class="warning-content"><strong>‚ö†Ô∏è C·∫£nh b√°o:</strong>Hi·ªán t·∫°i ƒëang s·ª≠ d·ª•ng thu·∫≠t to√°n d·ª± ƒëo√°n ƒë∆°n gi·∫£n thay v√¨ m√¥ h√¨nh Random Forest.<details class="warning-details"><summary>Chi ti·∫øt thu·∫≠t to√°n mock</summary><ul><li><strong>Vote Average:</strong>T√°c ƒë·ªông 76.53%(y·∫øu t·ªë quan tr·ªçng nh·∫•t)</li><li><strong>ROI(n·∫øu c√≥):</strong>T√°c ƒë·ªông 23.47%</li><li><strong>Budget,Runtime,Genre:</strong>T√°c ƒë·ªông minimal(~0%)</li><li><strong>ƒê·ªô ch√≠nh x√°c:</strong>Kho·∫£ng 75-85%(∆∞·ªõc t√≠nh)</li></ul><p><small>ƒê·ªÉ c√≥ k·∫øt qu·∫£ ch√≠nh x√°c nh·∫•t,c·∫ßn kh·ªüi ƒë·ªông server Flask v·ªõi m√¥ h√¨nh Random Forest ƒë√£ training(Accuracy:99.52%)</small></p></details></div></div>`;const resultsSection=document.querySelector('.prediction-results-section');if (resultsSection){resultsSection.insertAdjacentHTML('afterbegin',warningHtml);}}else {const successHtml=`<div class="model-status-success alert-success"><i class="fas fa-check-circle"></i><div class="success-content"><strong>‚úÖ Random Forest Model:</strong>S·ª≠ d·ª•ng m√¥ h√¨nh AI th·ª±c v·ªõi ƒë·ªô ch√≠nh x√°c 99.52%<div class="model-details"><span class="model-info">Trained tr√™n 1,022 b·ªô phim t·ª´ TMDB</span><span class="model-info">${result.model_info?.features_used || 47}features ƒë∆∞·ª£c s·ª≠ d·ª•ng</span><span class="model-info">Vote Average:76.53% importance | ROI:23.47% importance</span></div></div></div>`;const resultsSection=document.querySelector('.prediction-results-section');if (resultsSection){resultsSection.insertAdjacentHTML('afterbegin',successHtml);}}},updateConfidenceGauge(confidence){const confidenceText=document.getElementById('confidence-text');const confidenceCard=document.querySelector('.confidence-card-macos')|| document.querySelector('.confidence-card');const confidenceStatus=document.getElementById('confidence-status');const confidenceLevel=document.getElementById('confidence-level');const confidenceRating=document.getElementById('confidence-rating');console.log('updateConfidenceGauge called with:',{confidence,confidenceText,confidenceCard,confidenceStatus});if (confidenceText && confidenceCard){let currentValue=0;const startTime=Date.now();const duration=2000;const animateNumber=()=>{const elapsed=Date.now()-startTime;const progress=Math.min(elapsed/duration,1);const easedProgress=1-Math.pow(1-progress,3);currentValue=easedProgress*confidence;confidenceText.textContent=currentValue.toFixed(2);if (progress<1){requestAnimationFrame(animateNumber);}else {confidenceText.textContent=confidence.toFixed(2);console.log('Confidence animation complete:',confidence.toFixed(2));updateConfidenceMetrics(confidence);}};const updateConfidenceMetrics=(finalConfidence)=>{if (finalConfidence>=85){confidenceText.style.color='#059669';if (confidenceStatus){confidenceStatus.textContent='R·∫•t tin c·∫≠y';confidenceStatus.className='status-badge success';}if (confidenceLevel){confidenceLevel.textContent='R·∫•t cao';confidenceLevel.className='metric-value high';}if (confidenceRating){confidenceRating.textContent='A+';}confidenceCard.classList.add('high-confidence');}else if (finalConfidence>=70){confidenceText.style.color='#10B981';if (confidenceStatus){confidenceStatus.textContent='Tin c·∫≠y';confidenceStatus.className='status-badge good';}if (confidenceLevel){confidenceLevel.textContent='Cao';confidenceLevel.className='metric-value high';}if (confidenceRating){confidenceRating.textContent='A';}confidenceCard.classList.remove('high-confidence');}else if (finalConfidence>=60){confidenceText.style.color='#4F46E5';if (confidenceStatus){confidenceStatus.textContent='Kh√° tin c·∫≠y';confidenceStatus.className='status-badge good';}if (confidenceLevel){confidenceLevel.textContent='Trung b√¨nh';confidenceLevel.className='metric-value medium';}if (confidenceRating){confidenceRating.textContent='B+';}confidenceCard.classList.remove('high-confidence');}else {confidenceText.style.color='#EA580C';if (confidenceStatus){confidenceStatus.textContent='C·∫ßn c√¢n nh·∫Øc';confidenceStatus.className='status-badge medium';}if (confidenceLevel){confidenceLevel.textContent='Th·∫•p';confidenceLevel.className='metric-value low';}if (confidenceRating){confidenceRating.textContent='C+';}confidenceCard.classList.remove('high-confidence');}};setTimeout(animateNumber,300);}else {console.warn('updateConfidenceGauge:Missing elements',{confidenceText,confidenceCard,confidenceStatus,confidenceLevel,confidenceRating});}},updateMetrics(metrics,data){const safeNumber=(value,defaultValue=0)=>{const num=parseFloat(value);return isNaN(num)? defaultValue:num;};const predictedROI=safeNumber(metrics.predictedROI,0);const predictedRevenue=safeNumber(metrics.predictedRevenue,0);const budget=safeNumber(data.budget,0);const voteAverage=safeNumber(data.voteAverage,7.5);this.updateMetricValue('predicted-roi',`${predictedROI.toFixed(2)}x`);this.updateMetricValue('predicted-revenue',`${(predictedRevenue/1000000000).toFixed(1)}t·ª∑`);this.updateMetricValue('break-even',`${((budget*1.1)/1000000000).toFixed(1)}t·ª∑`);this.updateMetricValue('market-potential',metrics.marketPotential || 'Trung b√¨nh');this.updateMetricValue('risk-level',metrics.riskLevel || 'Trung b√¨nh');this.updateMetricValue('rating-display',voteAverage.toFixed(1));this.updateMetricValue('profit-margin',metrics.profitMargin || 'N/A');this.updateMetricValue('investment-grade',metrics.investmentGrade || 'N/A');this.updateMetricValue('competition-level',metrics.competitionLevel || 'N/A');this.updateMetricValue('target-audience',metrics.targetAudience || 'N/A');this.updateMetricValue('release-strategy',metrics.releaseStrategy || 'N/A');if (metrics.financialBreakdown){this.updateMetricValue('production-cost',`${(metrics.financialBreakdown.production/1000000).toFixed(1)}M`);this.updateMetricValue('marketing-cost',`${(metrics.financialBreakdown.marketing/1000000).toFixed(1)}M`);this.updateMetricValue('expected-profit',`${(metrics.financialBreakdown.expectedProfit/1000000).toFixed(1)}M`);this.updateMetricValue('break-even-days',`${metrics.financialBreakdown.breakEvenDays}ng√†y`);}this.updateMetricColors(metrics);this.generateBusinessInsights(metrics,data);},updateMetricColors(metrics){const roi=document.getElementById('predicted-roi');const potential=document.getElementById('market-potential');const risk=document.getElementById('risk-level');if (roi){roi.className=`metric-value ${parseFloat(metrics.predictedROI)>1.5 ? 'success':parseFloat(metrics.predictedROI)>1.0 ? 'warning':'danger'}`;}if (potential){potential.className=`metric-value ${metrics.marketPotential==='Cao' ? 'success':metrics.marketPotential==='Trung b√¨nh' ? 'warning':'danger'}`;}if (risk){risk.className=`metric-value ${metrics.riskLevel==='Th·∫•p' ? 'success':metrics.riskLevel==='Trung b√¨nh' ? 'warning':'danger'}`;}},updateMetricValue(metricId,value){const element=document.getElementById(metricId);if (element){element.textContent=value;}},generateBusinessInsights(metrics,data){const insightsContainer=document.getElementById('business-insights');if (!insightsContainer)return;const insights=[];const roi=parseFloat(metrics.predictedROI)|| 0;if (roi>2.0){insights.push({type:'positive',icon:'üéØ',title:'ROI Xu·∫•t S·∫Øc',description:`D·ª± √°n c√≥ ti·ªÅm nƒÉng sinh l·ªùi r·∫•t cao v·ªõi ROI ${roi.toFixed(1)}x. ƒê√¢y l√† m·ªôt c∆° h·ªôi ƒë·∫ßu t∆∞ t·ªët.`});}else if (roi>1.0){insights.push({type:'positive',icon:'‚úÖ',title:'ROI Kh·∫£ Quan',description:`D·ª± √°n d·ª± ki·∫øn sinh l·ªùi v·ªõi ROI ${roi.toFixed(1)}x,ƒë·∫°t m·ª©c an to√†n cho ƒë·∫ßu t∆∞.`});}else {insights.push({type:'negative',icon:'‚ö†Ô∏è',title:'ROI Th·∫•p',description:`ROI ch·ªâ ${roi.toFixed(1)}x. C·∫ßn xem x√©t l·∫°i chi·∫øn l∆∞·ª£c marketing v√† ph√¢n ph·ªëi.`});}const budgetInBillions=(parseFloat(data.budget)|| 0)/1000000000;if (budgetInBillions>0 && budgetInBillions<0.03){insights.push({type:'warning',icon:'üí∞',title:'Ng√¢n S√°ch H·∫°n Ch·∫ø',description:`V·ªõi ng√¢n s√°ch ${budgetInBillions.toFixed(2)}t·ª∑,c·∫ßn t·∫≠p trung v√†o marketing hi·ªáu qu·∫£ v√† ch·ªçn l·ª±a di·ªÖn vi√™n ph√π h·ª£p.`});}else if (budgetInBillions>0.1){insights.push({type:'positive',icon:'üíé',title:'Ng√¢n S√°ch L·ªõn',description:`Ng√¢n s√°ch ${budgetInBillions.toFixed(2)}t·ª∑ cho ph√©p s·∫£n xu·∫•t ch·∫•t l∆∞·ª£ng cao v√† chi·∫øn d·ªãch marketing r·ªông r√£i.`});}if (data.genres && data.genres.length>0){const popularGenres=['Action','Comedy','Drama'];const hasPopularGenre=data.genres.some(g=>popularGenres.includes(g));if (hasPopularGenre){insights.push({type:'positive',icon:'üé¨',title:'Th·ªÉ Lo·∫°i Ph·ªï Bi·∫øn',description:`Th·ªÉ lo·∫°i ${data.genres.join(',')}c√≥ l∆∞·ª£ng kh√°n gi·∫£ ƒë√¥ng ƒë·∫£o,tƒÉng c∆° h·ªôi th√†nh c√¥ng.`});}}if (data.voteAverage>=7.5){insights.push({type:'positive',icon:'‚≠ê',title:'Ch·∫•t L∆∞·ª£ng Cao',description:`ƒêi·ªÉm ƒë√°nh gi√° d·ª± ki·∫øn ${data.voteAverage}/10 r·∫•t t·ªët,c√≥ th·ªÉ t·∫°o hi·ªáu ·ª©ng truy·ªÅn mi·ªáng m·∫°nh m·∫Ω.`});}else if (data.voteAverage<6.0){insights.push({type:'warning',icon:'üìù',title:'C·∫ßn C·∫£i Thi·ªán Ch·∫•t L∆∞·ª£ng',description:`ƒêi·ªÉm ${data.voteAverage}/10 c√≤n th·∫•p. N√™n ƒë·∫ßu t∆∞ th√™m v√†o k·ªãch b·∫£n v√† ƒë·∫°o di·ªÖn.`});}const peakMonths=[1,2,4,5,12];if (peakMonths.includes(data.releaseMonth)){insights.push({type:'positive',icon:'üìÖ',title:'Th·ªùi ƒêi·ªÉm Ra M·∫Øt T·ªët',description:`Th√°ng ${data.releaseMonth}l√† m√πa cao ƒëi·ªÉm,kh√°n gi·∫£ c√≥ xu h∆∞·ªõng ƒëi xem phim nhi·ªÅu h∆°n.`});}if (metrics.riskLevel==='Th·∫•p'){insights.push({type:'positive',icon:'üõ°Ô∏è',title:'R·ªßi Ro Th·∫•p',description:'D·ª± √°n c√≥ m·ª©c ƒë·ªô r·ªßi ro th·∫•p,ph√π h·ª£p cho nh√† ƒë·∫ßu t∆∞ th·∫≠n tr·ªçng.'});}else if (metrics.riskLevel==='Cao'){insights.push({type:'negative',icon:'üö®',title:'R·ªßi Ro Cao',description:'C·∫ßn c√≥ k·∫ø ho·∫°ch d·ª± ph√≤ng v√† chi·∫øn l∆∞·ª£c marketing m·∫°nh m·∫Ω ƒë·ªÉ gi·∫£m thi·ªÉu r·ªßi ro.'});}insightsContainer.innerHTML=insights.map(insight=>`<div class="insight-card ${insight.type}"><div class="insight-icon">${insight.icon}</div><div class="insight-content"><div class="insight-title">${insight.title}</div><div class="insight-description">${insight.description}</div></div></div>`).join('');},setupCharts(){this.initializeFeatureImportanceChart();this.initializeGenrePerformanceChart();this.initializeBudgetROIChart();this.initializeCorrelationChart();this.initializeTimeSeriesChart();this.initializePredictionDistribution();},initializeFeatureImportanceChart(){const ctx=document.getElementById('featureImportanceChart');if (!ctx)return;const data={labels:['Budget','Vote Average','Runtime','Genre','Production Company','Release Date'],datasets:[{label:'Importance Score',data:[0.35,0.28,0.15,0.12,0.08,0.02],backgroundColor:this.getChartColors().primary,borderColor:this.getChartColors().primaryBorder,borderWidth:1}]};this.charts.featureImportance=new Chart(ctx,{type:'bar',data:data,options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},title:{display:true,text:'T·∫ßm quan tr·ªçng c·ªßa c√°c y·∫øu t·ªë',color:this.getTextColor()}},scales:{y:{beginAtZero:true,ticks:{color:this.getTextColor()},grid:{color:this.getGridColor()}},x:{ticks:{color:this.getTextColor()},grid:{color:this.getGridColor()}}}}});},initializeGenrePerformanceChart(){const ctx=document.getElementById('genrePerformanceChart');if (!ctx)return;const data={labels:['Action','Comedy','Drama','Horror','Romance','Sci-Fi'],datasets:[{label:'Success Rate(%)',data:[75,68,62,45,58,72],backgroundColor:this.getChartColors().secondary,borderColor:this.getChartColors().secondaryBorder,borderWidth:1}]};this.charts.genrePerformance=new Chart(ctx,{type:'doughnut',data:data,options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom',labels:{color:this.getTextColor()}},title:{display:true,text:'T·ª∑ l·ªá th√†nh c√¥ng theo th·ªÉ lo·∫°i',color:this.getTextColor()}}}});},initializeBudgetROIChart(){const ctx=document.getElementById('budgetROIChart');if (!ctx)return;const data={datasets:[{label:'ROI vs Budget',data:this.generateScatterData(),backgroundColor:this.getChartColors().accent,borderColor:this.getChartColors().accentBorder,pointRadius:5}]};this.charts.budgetROI=new Chart(ctx,{type:'scatter',data:data,options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{color:this.getTextColor()}},title:{display:true,text:'M·ªëi quan h·ªá Budget-ROI',color:this.getTextColor()}},scales:{x:{type:'linear',title:{display:true,text:'Budget(Million $)',color:this.getTextColor()},ticks:{color:this.getTextColor()},grid:{color:this.getGridColor()}},y:{title:{display:true,text:'ROI',color:this.getTextColor()},ticks:{color:this.getTextColor()},grid:{color:this.getGridColor()}}}}});},initializeCorrelationChart(){const ctx=document.getElementById('correlationChart');if (!ctx)return;const data={labels:['Budget','Revenue','Vote Avg','Runtime','Vote Count'],datasets:[{label:'Correlation Matrix',data:[{x:0,y:0,v:1.0},{x:1,y:0,v:0.75},{x:2,y:0,v:0.23},{x:3,y:0,v:0.45},{x:4,y:0,v:0.67},{x:0,y:1,v:0.75},{x:1,y:1,v:1.0},{x:2,y:1,v:0.34},{x:3,y:1,v:0.28},{x:4,y:1,v:0.82}],backgroundColor:function (context){const value=context.parsed.v;const alpha=Math.abs(value);return value>0 ? `rgba(37,99,235,${alpha})`:`rgba(239,68,68,${alpha})`;}}]};const correlationData={labels:['Budget-Revenue','Budget-Rating','Budget-Runtime','Rating-Revenue'],datasets:[{label:'Correlation Strength',data:[0.75,0.23,0.45,0.34],backgroundColor:this.getChartColors().mixed}]};this.charts.correlation=new Chart(ctx,{type:'bar',data:correlationData,options:{indexAxis:'y',responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},title:{display:true,text:'Ma tr·∫≠n t∆∞∆°ng quan',color:this.getTextColor()}},scales:{x:{beginAtZero:true,max:1,ticks:{color:this.getTextColor()},grid:{color:this.getGridColor()}},y:{ticks:{color:this.getTextColor()},grid:{color:this.getGridColor()}}}}});},initializeTimeSeriesChart(){const ctx=document.getElementById('timeSeriesChart');if (!ctx)return;const data={labels:['2019','2020','2021','2022','2023','2024'],datasets:[{label:'Success Rate',data:[65,42,38,55,68,72],borderColor:this.getChartColors().primary,backgroundColor:this.getChartColors().primary+'20',fill:true,tension:0.4}]};this.charts.timeSeries=new Chart(ctx,{type:'line',data:data,options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{color:this.getTextColor()}},title:{display:true,text:'Xu h∆∞·ªõng th√†nh c√¥ng theo th·ªùi gian',color:this.getTextColor()}},scales:{x:{ticks:{color:this.getTextColor()},grid:{color:this.getGridColor()}},y:{beginAtZero:true,max:100,ticks:{color:this.getTextColor(),callback:function (value){return value+'%';}},grid:{color:this.getGridColor()}}}}});},initializePredictionDistribution(){const ctx=document.getElementById('predictionDistributionChart');if (!ctx)return;const data={labels:['0-20%','21-40%','41-60%','61-80%','81-100%'],datasets:[{label:'S·ªë l∆∞·ª£ng phim',data:[150,280,420,380,270],backgroundColor:this.getChartColors().gradient}]};this.charts.predictionDistribution=new Chart(ctx,{type:'bar',data:data,options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},title:{display:true,text:'Ph√¢n b·ªë x√°c su·∫•t th√†nh c√¥ng',color:this.getTextColor()}},scales:{x:{title:{display:true,text:'Kho·∫£ng x√°c su·∫•t th√†nh c√¥ng',color:this.getTextColor()},ticks:{color:this.getTextColor()},grid:{color:this.getGridColor()}},y:{title:{display:true,text:'S·ªë l∆∞·ª£ng phim',color:this.getTextColor()},ticks:{color:this.getTextColor()},grid:{color:this.getGridColor()}}}}});},getChartColors(){const isDark=this.currentTheme==='dark';return{primary:'#2563EB',primaryBorder:'#1D4ED8',secondary:'#7C3AED',secondaryBorder:'#6D28D9',accent:'#059669',accentBorder:'#047857',mixed:['#2563EB','#7C3AED','#059669','#EA580C','#DC2626'],gradient:['rgba(37,99,235,0.8)','rgba(124,58,237,0.8)','rgba(5,150,105,0.8)','rgba(234,88,12,0.8)','rgba(220,38,38,0.8)']};},getTextColor(){return this.currentTheme==='dark' ? '#F8FAFC':'#111827';},getGridColor(){return this.currentTheme==='dark' ? '#334155':'#E5E7EB';},generateScatterData(){const data=[];for (let i=0;i<50;i++){data.push({x:Math.random()*200+1,y:Math.random()*5+0.5});}return data;},updateChartsTheme(){Object.values(this.charts).forEach(chart=>{if (chart && chart.options){this.updateChartThemeColors(chart);chart.update('none');}});},updateChartThemeColors(chart){const textColor=this.getTextColor();const gridColor=this.getGridColor();if (chart.options.plugins && chart.options.plugins.title){chart.options.plugins.title.color=textColor;}if (chart.options.plugins && chart.options.plugins.legend){chart.options.plugins.legend.labels.color=textColor;}if (chart.options.scales){Object.values(chart.options.scales).forEach(scale=>{if (scale.ticks)scale.ticks.color=textColor;if (scale.grid)scale.grid.color=gridColor;if (scale.title)scale.title.color=textColor;});}},updateChartsWithPrediction(result){this.generateGenrePerformanceChart(result.data.genres);this.generateBudgetSuccessChart(result);},generateGenrePerformanceChart(selectedGenres){const ctx=document.getElementById('genre-performance-chart');if (!ctx)return;if (typeof Chart==='undefined'){console.error('Chart.js is not loaded yet');return;}const genreSuccessRates={'Action':72,'Adventure':68,'Animation':75,'Comedy':65,'Crime':58,'Documentary':45,'Drama':62,'Family':70,'Fantasy':66,'Horror':55,'Music':60,'Mystery':61,'Romance':63,'Science Fiction':68,'Thriller':64,'War':52,'Western':48};const labels=selectedGenres && selectedGenres.length>0 ? selectedGenres:['Action','Comedy','Drama'];const data=labels.map(genre=>genreSuccessRates[genre]|| 50);const colors=labels.map((_,i)=>{const hue=(i*360)/labels.length;return `hsl(${hue},70%,60%)`;});if (this.charts.genrePerformance){this.charts.genrePerformance.destroy();}this.charts.genrePerformance=new Chart(ctx,{type:'doughnut',data:{labels:labels,datasets:[{data:data,backgroundColor:colors,borderColor:this.currentTheme==='dark' ? '#1e293b':'#ffffff',borderWidth:3}]},options:{responsive:true,maintainAspectRatio:true,plugins:{legend:{position:'bottom',labels:{color:this.currentTheme==='dark' ? '#e2e8f0':'#334155',font:{size:12,weight:600},padding:15}},tooltip:{callbacks:{label:function (context){return `${context.label}:${context.parsed}% t·ª∑ l·ªá th√†nh c√¥ng`;}}}}}});},generateBudgetSuccessChart(result){const ctx=document.getElementById('budget-success-chart');if (!ctx)return;if (typeof Chart==='undefined'){console.error('Chart.js is not loaded yet');return;}const sampleData=[{x:10,y:3.5,success:true},{x:25,y:2.8,success:true},{x:50,y:2.2,success:true},{x:75,y:1.8,success:true},{x:100,y:1.5,success:true},{x:150,y:1.2,success:true},{x:15,y:0.8,success:false},{x:30,y:0.9,success:false},{x:60,y:0.7,success:false},{x:90,y:0.6,success:false}];const successData=sampleData.filter(d=>d.success);const failureData=sampleData.filter(d=>!d.success);const currentPrediction={x:result.data.budget,y:parseFloat(result.metrics.predictedROI)};if (this.charts.budgetSuccess){this.charts.budgetSuccess.destroy();}this.charts.budgetSuccess=new Chart(ctx,{type:'scatter',data:{datasets:[{label:'Phim Th√†nh C√¥ng',data:successData,backgroundColor:'rgba(16,185,129,0.6)',borderColor:'rgba(16,185,129,1)',borderWidth:2,pointRadius:6,pointHoverRadius:8},{label:'Phim Th·∫•t B·∫°i',data:failureData,backgroundColor:'rgba(239,68,68,0.6)',borderColor:'rgba(239,68,68,1)',borderWidth:2,pointRadius:6,pointHoverRadius:8},{label:'D·ª± ƒêo√°n C·ªßa B·∫°n',data:[currentPrediction],backgroundColor:'rgba(37,99,235,0.8)',borderColor:'rgba(37,99,235,1)',borderWidth:3,pointRadius:10,pointHoverRadius:12,pointStyle:'star'}]},options:{responsive:true,maintainAspectRatio:true,plugins:{legend:{position:'bottom',labels:{color:this.currentTheme==='dark' ? '#e2e8f0':'#334155',font:{size:12,weight:600},padding:15}},tooltip:{callbacks:{label:function (context){return `Ng√¢n s√°ch:${context.parsed.x}t·ª∑,ROI:${context.parsed.y.toFixed(1)}x`;}}}},scales:{x:{title:{display:true,text:'Ng√¢n S√°ch(t·ª∑ VND)',color:this.currentTheme==='dark' ? '#e2e8f0':'#334155',font:{weight:600}},ticks:{color:this.currentTheme==='dark' ? '#94a3b8':'#64748b'},grid:{color:this.currentTheme==='dark' ? 'rgba(71,85,105,0.3)':'rgba(203,213,225,0.3)'}},y:{title:{display:true,text:'ROI(l·∫ßn)',color:this.currentTheme==='dark' ? '#e2e8f0':'#334155',font:{weight:600}},ticks:{color:this.currentTheme==='dark' ? '#94a3b8':'#64748b'},grid:{color:this.currentTheme==='dark' ? 'rgba(71,85,105,0.3)':'rgba(203,213,225,0.3)'}}}}});},updateInsights(result){const insightsList=document.querySelector('.insights-list');if (!insightsList)return;insightsList.innerHTML='';const insights=this.generateInsights(result);insights.forEach(insight=>{const insightElement=document.createElement('div');insightElement.className='insight-item';insightElement.innerHTML=`<div class="insight-title">${insight.title}</div><div class="insight-description">${insight.description}</div>`;insightsList.appendChild(insightElement);});},generateInsights(result){const insights=[];const{data,success,confidence,metrics}=result;if (data.budget>100000000){insights.push({title:'Ng√¢n s√°ch cao',description:`V·ªõi ng√¢n s√°ch ${this.formatCurrency(data.budget)},phim thu·ªôc nh√≥m blockbuster. Phim n√†y c·∫ßn doanh thu cao ƒë·ªÉ c√≥ l·ªùi.`});}else if (data.budget<5000000){insights.push({title:'Ng√¢n s√°ch th·∫•p',description:'Phim c√≥ ng√¢n s√°ch th·∫•p th∆∞·ªùng c√≥ r·ªßi ro th·∫•p h∆°n nh∆∞ng ti·ªÅm nƒÉng l·ª£i nhu·∫≠n c≈©ng h·∫°n ch·∫ø.'});}if (data.voteAverage>=8.0){insights.push({title:'Ch·∫•t l∆∞·ª£ng xu·∫•t s·∫Øc',description:'ƒêi·ªÉm ƒë√°nh gi√° cao(‚â•8.0)th∆∞·ªùng d·∫´n ƒë·∫øn th√†nh c√¥ng t·∫°i ph√≤ng v√© v√† gi·∫£i th∆∞·ªüng.'});}else if (data.voteAverage<6.0){insights.push({title:'R·ªßi ro ch·∫•t l∆∞·ª£ng',description:'ƒêi·ªÉm ƒë√°nh gi√° d∆∞·ªõi 6.0 c√≥ th·ªÉ ·∫£nh h∆∞·ªüng ti√™u c·ª±c ƒë·∫øn doanh thu.'});}const highPerformanceGenres=['Action','Adventure','Animation'];const hasHighPerformanceGenre=data.genres.some(g=>highPerformanceGenres.includes(g));if (hasHighPerformanceGenre){insights.push({title:'Th·ªÉ lo·∫°i ph·ªï bi·∫øn',description:'Phim thu·ªôc th·ªÉ lo·∫°i c√≥ t·ª∑ l·ªá th√†nh c√¥ng cao trong th·ªã tr∆∞·ªùng hi·ªán t·∫°i.'});}if (success){insights.push({title:'D·ª± ƒëo√°n t√≠ch c·ª±c',description:`Model d·ª± ƒëo√°n phim s·∫Ω th√†nh c√¥ng v·ªõi ƒë·ªô tin c·∫≠y ${confidence}%. ROI d·ª± ki·∫øn:${metrics.predictedROI}.`});}else {insights.push({title:'C·∫ßn c√¢n nh·∫Øc',description:`Model cho th·∫•y r·ªßi ro cao. N√™n xem x√©t ƒëi·ªÅu ch·ªânh ng√¢n s√°ch ho·∫∑c chi·∫øn l∆∞·ª£c marketing.`});}return insights;},updateDashboardPreview(){const bars=document.querySelectorAll('.bar');bars.forEach((bar,index)=>{const heights=['20px','35px','25px','40px','30px'];bar.style.setProperty('--height',heights[index]);bar.style.animationDelay=`${index*0.2}s`;});},showLoading(){this.isLoading=true;let overlay=document.getElementById('loadingOverlay');if (!overlay){overlay=document.createElement('div');overlay.id='loadingOverlay';overlay.className='loading-overlay';overlay.innerHTML=`<div class="loading-spinner"><div class="spinner"></div><p>ƒêang d·ª± ƒëo√°n...</p></div>`;document.body.appendChild(overlay);}overlay.style.display='flex';const form=document.getElementById('predictionForm');if (form){const inputs=form.querySelectorAll('input,select,button');inputs.forEach(input=>input.disabled=true);}},showResultsLoading(){const loadingOverlay=document.getElementById('results-loading-overlay');if (loadingOverlay){this.updateModelInfoInLoading();loadingOverlay.style.display='flex';setTimeout(()=>{loadingOverlay.classList.add('active');},10);}},updateModelInfoInLoading(){const modelInfoSection=document.getElementById('model-info-loading');if (!modelInfoSection)return;const html=`<div class="model-info-content"><div class="model-header"><span class="model-badge">ü§ñ Random Forest Model</span></div><div class="model-details"><div class="model-detail-item"><span class="detail-label">ƒê·ªô ch√≠nh x√°c:</span><span class="detail-value">99.52%</span></div><div class="model-detail-item"><span class="detail-label">Features:</span><span class="detail-value">47</span></div><div class="model-detail-item"><span class="detail-label">Tr·∫°ng th√°i:</span><span class="detail-value status-active">ƒêang x·ª≠ l√Ω...</span></div></div><div class="model-note"><small>üîç M√¥ h√¨nh ph√¢n t√≠ch Vote Average(76.53%),ROI(23.47%)v√† 45 features kh√°c</small></div></div>`;modelInfoSection.innerHTML=html;},hideResultsLoading(){const loadingOverlay=document.getElementById('results-loading-overlay');if (loadingOverlay){loadingOverlay.classList.remove('active');setTimeout(()=>{loadingOverlay.style.display='none';},300);}},hideLoading(){this.isLoading=false;const overlay=document.getElementById('loadingOverlay');if (overlay){overlay.style.display='none';}const form=document.getElementById('predictionForm');if (form){const inputs=form.querySelectorAll('input,select,button');inputs.forEach(input=>input.disabled=false);}},showError(message){this.showNotification(message,'error');},showSuccess(message){this.showNotification(message,'success');},showNotification(message,type='error'){const notification=document.createElement('div');const bgColor=type==='success' ? '#10B981':'#DC2626';notification.style.cssText=` position:fixed;top:20px;right:20px;background:${bgColor};color:white;padding:1rem 1.5rem;border-radius:12px;box-shadow:0 10px 15px-3px rgba(0,0,0,0.2);z-index:10000;animation:slideInRight 0.3s ease;max-width:400px;font-weight:600;`;notification.textContent=message;const style=document.createElement('style');style.textContent=` @keyframes slideInRight{from{transform:translateX(100%);opacity:0;}to{transform:translateX(0);opacity:1;}}`;document.head.appendChild(style);document.body.appendChild(notification);setTimeout(()=>{notification.style.animation='slideInRight 0.3s ease reverse';setTimeout(()=>{notification.remove();style.remove();},300);},4000);}};function formatNumber(num){if (num>=1000000000){return (num/1000000000).toFixed(1)+'B';}else if (num>=1000000){return (num/1000000).toFixed(1)+'M';}else if (num>=1000){return (num/1000).toFixed(1)+'K';}return num.toString();}function debounce(func,wait){let timeout;return function executedFunction(...args){const later=()=>{clearTimeout(timeout);func(...args);};clearTimeout(timeout);timeout=setTimeout(later,wait);};}function resetForm(){const form=document.getElementById('prediction-form');if (form){form.reset();document.querySelector('#vote_average+.range-value').textContent='6.5';document.querySelector('#budget+.range-value').textContent='50 t·ª∑';document.querySelector('#runtime+.range-value').textContent='120 ph√∫t';document.querySelector('#vote_count+.range-value').textContent='5,000';const results=document.getElementById('results');if (results){results.style.display='none';results.classList.remove('show');}document.getElementById('app').scrollIntoView({behavior:'smooth'});}}function exportResults(){if (!App.predictionResult){App.showError('Ch∆∞a c√≥ k·∫øt qu·∫£ ƒë·ªÉ xu·∫•t. Vui l√≤ng th·ª±c hi·ªán d·ª± ƒëo√°n tr∆∞·ªõc.');return;}const result=App.predictionResult;const data=result.data;const reportContent=` B√ÅOC√ÅO D·ª∞ ƒêO√ÅN TH√ÄNH C√îNG PHIM=====================================TH√îNG TIN PHIM:-T√™n phim:${data.title}-Ng√¢n s√°ch:${data.budget}t·ª∑ VND-Th·ªùi l∆∞·ª£ng:${data.runtime}ph√∫t-ƒêi·ªÉm ƒë√°nh gi√° d·ª± ki·∫øn:${data.voteAverage}/10-Th·ªÉ lo·∫°i:${data.genres.join(',')}K·∫æT QU·∫¢ D·ª∞ ƒêO√ÅN:-D·ª± ƒëo√°n:${result.success ? 'TH√ÄNH C√îNG':'TH·∫§T B·∫†I'}-ƒê·ªô tin c·∫≠y:${result.confidence}%-ROI d·ª± ki·∫øn:${result.metrics.predictedROI}-Doanh thu d·ª± ki·∫øn:${(result.metrics.predictedRevenue/1000000000).toFixed(1)}t·ª∑ VND-M·ª©c ƒë·ªô r·ªßi ro:${result.metrics.riskLevel}-Ti·ªÅm nƒÉng th·ªã tr∆∞·ªùng:${result.metrics.marketPotential}B√°o c√°o ƒë∆∞·ª£c t·∫°o l√∫c:${new Date().toLocaleString('vi-VN')}ƒê∆∞·ª£c t·∫°o b·ªüi:FilmPredict AI System `;const blob=new Blob([reportContent],{type:'text/plain;charset=utf-8'});const url=window.URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`FilmPredict_${data.title.replace(/[^a-zA-Z0-9]/g,'_')}_${Date.now()}.txt`;document.body.appendChild(a);a.click();document.body.removeChild(a);window.URL.revokeObjectURL(url);}function shareResults(){if (!App.predictionResult){App.showError('Ch∆∞a c√≥ k·∫øt qu·∫£ ƒë·ªÉ chia s·∫ª. Vui l√≤ng th·ª±c hi·ªán d·ª± ƒëo√°n tr∆∞·ªõc.');return;}const result=App.predictionResult;const shareText=`üé¨ T√¥i v·ª´a d·ª± ƒëo√°n th√†nh c√¥ng phim "${result.data.title}" b·∫±ng AI! üìä K·∫øt qu·∫£:${result.success ? 'TH√ÄNH C√îNG':'TH·∫§T B·∫†I'}(ƒê·ªô tin c·∫≠y ${result.confidence}%)üí∞ ROI d·ª± ki·∫øn:${result.metrics.predictedROI}üéØ Ti·ªÅm nƒÉng:${result.metrics.marketPotential}Th·ª≠ d·ª± ƒëo√°n phim c·ªßa b·∫°n t·∫°i:${window.location.href}#FilmPredict #AI #MoviePrediction`;if (navigator.share){navigator.share({title:'K·∫øt qu·∫£ d·ª± ƒëo√°n phim FilmPredict',text:shareText,url:window.location.href}).catch(err=>console.log('Error sharing:',err));}else {navigator.clipboard.writeText(shareText).then(()=>{App.showSuccess('ƒê√£ sao ch√©p k·∫øt qu·∫£ v√†o clipboard!');}).catch(()=>{App.showError('Kh√¥ng th·ªÉ sao ch√©p. Vui l√≤ng th·ª≠ l·∫°i.');});}}function setupTooltips(){const tooltipBtns=document.querySelectorAll('.tooltip-btn');tooltipBtns.forEach(btn=>{btn.addEventListener('click',(e)=>{e.preventDefault();const tooltipId=btn.getAttribute('data-tooltip');const tooltipContent=document.getElementById(`tooltip-${tooltipId}`);if (tooltipContent){const isVisible=tooltipContent.classList.contains('show');document.querySelectorAll('.tooltip-content').forEach(t=>{t.classList.remove('show');});if (!isVisible){tooltipContent.classList.add('show');}}});});document.addEventListener('click',(e)=>{if (!e.target.closest('.tooltip-btn')&& !e.target.closest('.tooltip-content')){document.querySelectorAll('.tooltip-content').forEach(t=>{t.classList.remove('show');});}});}function setupQuickFillButtons(){const exampleData={mai:{title:'Mai(2024)',voteAverage:6.8,revenue:22119910,budget:2503150,runtime:133,genres:['Drama','Comedy','Romance']},avengers:{title:'Avengers:Endgame',voteAverage:8.4,revenue:2797800564,budget:356000000,runtime:181,genres:['Action','Adventure','Science Fiction']},indie:{title:'Independent Drama',voteAverage:7.2,revenue:3500000,budget:2000000,runtime:105,genres:['Drama']}};const quickFillBtns=document.querySelectorAll('.quick-fill-btn');quickFillBtns.forEach(btn=>{btn.addEventListener('click',(e)=>{e.preventDefault();const exampleKey=btn.getAttribute('data-example');const data=exampleData[exampleKey];if (data){document.getElementById('title').value=data.title;document.getElementById('vote_average').value=data.voteAverage;document.querySelector('#vote_average+.range-value').textContent=data.voteAverage;document.getElementById('revenue').value=data.revenue;document.getElementById('budget').value=data.budget;document.getElementById('runtime').value=data.runtime;document.querySelector('#runtime+.range-value').textContent=`${data.runtime}ph√∫t`;document.querySelectorAll('.genre-chip').forEach(chip=>{chip.classList.remove('active');});data.genres.forEach(genre=>{const chip=document.querySelector(`.genre-chip[data-genre="${genre}"]`);if (chip){chip.classList.add('active');}});document.getElementById('genres').value=JSON.stringify(data.genres);App.showSuccess(`ƒê√£ ƒëi·ªÅn th√¥ng tin cho "${data.title}"!`);const formSection=document.querySelector('.form-section.featured');if (formSection){formSection.scrollIntoView({behavior:'smooth',block:'start'});}}});});}function validateFormSimplified(){const title=document.getElementById('title').value.trim();const voteAverage=parseFloat(document.getElementById('vote_average').value);const revenue=parseFloat(document.getElementById('revenue').value);const budget=parseFloat(document.getElementById('budget').value);if (!title){App.showError('Vui l√≤ng nh·∫≠p t√™n phim');return false;}if (!voteAverage || voteAverage<1 || voteAverage>10){App.showError('Vote Average ph·∫£i t·ª´ 1-10');return false;}if (!revenue || revenue<0){App.showError('Revenue ph·∫£i l·ªõn h∆°n ho·∫∑c b·∫±ng 0');return false;}if (!budget || budget<=0){App.showError('Budget ph·∫£i l·ªõn h∆°n 0');return false;}if (revenue>0 && budget>0){const roi=(revenue/budget).toFixed(2);console.log(`Current ROI:${roi}x`);}return true;}document.addEventListener('visibilitychange',()=>{if (!document.hidden && App.charts){Object.values(App.charts).forEach(chart=>{if (chart && chart.resize){chart.resize();}});}});if (typeof module !=='undefined' && module.exports){module.exports=App;}function setupRealTimeValidation(){const requiredFields=document.querySelectorAll('[data-required="true"]input');requiredFields.forEach(input=>{input.addEventListener('input',(e)=>validateField(e.target));input.addEventListener('blur',(e)=>validateField(e.target));});}function validateField(input){const formGroup=input.closest('.form-group');const value=input.value.trim();let isValid=true;let errorMessage='';if (input.hasAttribute('required')&& !value){isValid=false;errorMessage='Tr∆∞·ªùng n√†y l√† b·∫Øt bu·ªôc';}if (input.id==='vote_average'){const vote=parseFloat(value);if (vote<0 || vote>10){isValid=false;errorMessage='Vote Average ph·∫£i t·ª´ 0 ƒë·∫øn 10';}}if (input.id==='revenue'){const revenue=parseFloat(value);if (revenue<0){isValid=false;errorMessage='Revenue kh√¥ng ƒë∆∞·ª£c √¢m';}}if (input.id==='budget'){const budget=parseFloat(value);if (budget<=0){isValid=false;errorMessage='Budget ph·∫£i l·ªõn h∆°n 0';}}if (isValid && value){formGroup.classList.remove('error');formGroup.classList.add('valid');}else if (!isValid){formGroup.classList.remove('valid');formGroup.classList.add('error');const errorElement=formGroup.querySelector('.error-message');if (errorElement){errorElement.textContent=errorMessage;}}else {formGroup.classList.remove('valid','error');}updateFormProgress();return isValid;}function updateFormProgress(){const requiredFields=document.querySelectorAll('[data-required="true"]input');let filledCount=0;requiredFields.forEach(input=>{const value=input.value.trim();if (value && validateField(input)){filledCount++;}});const totalRequired=3;const percentage=(filledCount/totalRequired)*100;const progressBar=document.getElementById('progressBarFill');const progressCount=document.getElementById('progressCount');if (progressBar){progressBar.style.width=`${percentage}%`;}if (progressCount){progressCount.textContent=`${filledCount}/${totalRequired}fields b·∫Øt bu·ªôc`;}}function setupEnhancedTooltips(){const tooltipButtons=document.querySelectorAll('.tooltip-btn');const tooltipContents=document.querySelectorAll('.tooltip-content');tooltipButtons.forEach(btn=>{btn.addEventListener('click',(e)=>{e.preventDefault();e.stopPropagation();const tooltipId=btn.getAttribute('data-tooltip');const content=document.getElementById(`tooltip-${tooltipId}`);tooltipContents.forEach(t=>{if (t !==content){t.classList.remove('show');}});if (content){content.classList.toggle('show');}});});const closeButtons=document.querySelectorAll('.tooltip-close');closeButtons.forEach(btn=>{btn.addEventListener('click',(e)=>{e.stopPropagation();const tooltip=btn.closest('.tooltip-content');if (tooltip){tooltip.classList.remove('show');}});});document.addEventListener('click',(e)=>{if (!e.target.closest('.tooltip-btn')&& !e.target.closest('.tooltip-content')){tooltipContents.forEach(t=>t.classList.remove('show'));}});document.addEventListener('keydown',(e)=>{if (e.key==='Escape'){tooltipContents.forEach(t=>t.classList.remove('show'));}});}function setupLoadingState(){console.log('‚ÑπÔ∏è setupLoadingState()disabled-using App.handleFormSubmit()instead');}function setLoadingState(button,isLoading){if (isLoading){button.disabled=true;button.classList.add('btn-loading');}else {button.disabled=false;button.classList.remove('btn-loading');}}function animateTrustIndicators(){const trustNumbers=document.querySelectorAll('.trust-number');const observerOptions={threshold:0.5,rootMargin:'0px'};const observer=new IntersectionObserver((entries)=>{entries.forEach(entry=>{if (entry.isIntersecting){const element=entry.target;const text=element.textContent;if (text.includes('%')|| text.includes(',')){animateNumber(element,text);}observer.unobserve(element);}});},observerOptions);trustNumbers.forEach(num=>observer.observe(num));}function animateNumber(element,finalText){const hasPercent=finalText.includes('%');const hasComma=finalText.includes(',');let finalNumber;if (hasPercent){finalNumber=parseFloat(finalText.replace('%',''));}else if (hasComma){finalNumber=parseInt(finalText.replace(',',''));}else {return;}const duration=1500;const steps=60;const stepValue=finalNumber/steps;let currentNumber=0;let currentStep=0;const interval=setInterval(()=>{currentNumber+=stepValue;currentStep++;let displayText;if (hasPercent){displayText=currentNumber.toFixed(1)+'%';}else if (hasComma){displayText=Math.floor(currentNumber).toLocaleString();}element.textContent=displayText;if (currentStep>=steps){element.textContent=finalText;clearInterval(interval);}},duration/steps);}function setupQuickFillEnhancements(){const quickFillButtons=document.querySelectorAll('.quick-fill-btn');quickFillButtons.forEach(btn=>{btn.addEventListener('click',()=>{btn.classList.add('filling');setTimeout(()=>{btn.classList.remove('filling');setTimeout(()=>{updateFormProgress();},100);},500);});});}function setupAccessibility(){const form=document.getElementById('prediction-form');if (form){form.setAttribute('aria-label','Bi·ªÉu m·∫´u d·ª± ƒëo√°n th√†nh c√¥ng phim');}const interactiveElements=document.querySelectorAll('button,a,input,select,textarea');interactiveElements.forEach(el=>{if (!el.hasAttribute('aria-label')&& !el.hasAttribute('aria-labelledby')){const text=el.textContent.trim()|| el.placeholder || el.value;if (text){el.setAttribute('aria-label',text);}}});const announcer=document.createElement('div');announcer.setAttribute('role','status');announcer.setAttribute('aria-live','polite');announcer.setAttribute('aria-atomic','true');announcer.className='sr-only';document.body.appendChild(announcer);App.announcer=announcer;}function announce(message){if (App.announcer){App.announcer.textContent='';setTimeout(()=>{App.announcer.textContent=message;},100);}}App.showRandomDataModal=function (){const modal=document.getElementById('random-data-modal');if (modal){modal.style.display='flex';setTimeout(()=>{modal.classList.add('active');},10);}};App.hideRandomDataModal=function (){const modal=document.getElementById('random-data-modal');if (modal){modal.classList.remove('active');setTimeout(()=>{modal.style.display='none';},300);}};App.fillRandomData=function (scenario){console.log('üé≤ Filling random data for scenario:',scenario);this.hideRandomDataModal();let randomData={};if (scenario==='success'){const voteAvg=8.0+Math.random()*1.5;const budget=50000000+Math.random()*150000000;const revenue=budget*(2.5+Math.random()*2.5);randomData={title:this.getRandomMovieTitle('success'),voteAverage:voteAvg,budget:Math.round(budget),revenue:Math.round(revenue),runtime:100+Math.floor(Math.random()*60),releaseMonth:[6,7,12][Math.floor(Math.random()*3)],};}else if (scenario==='average'){const voteAvg=6.5+Math.random()*0.8;const budget=30000000+Math.random()*50000000;const revenue=budget*(1.0+Math.random()*0.5);randomData={title:this.getRandomMovieTitle('average'),voteAverage:voteAvg,budget:Math.round(budget),revenue:Math.round(revenue),runtime:110+Math.floor(Math.random()*40),releaseMonth:[3,4,9,10][Math.floor(Math.random()*4)],};}else if (scenario==='failure'){const voteAvg=4.5+Math.random()*1.0;const budget=10000000+Math.random()*30000000;const revenue=budget*(0.3+Math.random()*0.6);randomData={title:this.getRandomMovieTitle('failure'),voteAverage:voteAvg,budget:Math.round(budget),revenue:Math.round(revenue),runtime:90+Math.floor(Math.random()*40),releaseMonth:[1,2,5,8][Math.floor(Math.random()*4)],};}const allGenres=['Action','Adventure','Animation','Comedy','Drama','Fantasy','Horror','Romance'];const numGenres=1+Math.floor(Math.random()*3);const selectedGenres=[];for (let i=0;i<numGenres;i++){selectedGenres.push(allGenres[Math.floor(Math.random()*allGenres.length)]);}randomData.genres=selectedGenres;this.fillFormWithData(randomData);setTimeout(()=>{const form=document.getElementById('prediction-form');if (form){console.log('üé¨ Auto-submitting form with random data...');form.dispatchEvent(new Event('submit'));}},300);};App.getRandomMovieTitle=function (scenario){const successTitles=['Avengers Endgame','Avatar','Titanic','Lion King','Frozen','The Hive','Dune','Top Gun','Barbie','Oppenheimer'];const averageTitles=['The Tourist','Goosebumps','The Ring','Insidious','Lucy','Pixels','Battleship','Percy Jackson','City of Angels','Aquaman'];const failureTitles=['Cats','The Emoji Movie','Disaster Movie','Birdemic','Gigli','Movie 43','Madea Express','The Room','Troll 2','Saving Christmas'];const titles=scenario==='success' ? successTitles:scenario==='average' ? averageTitles:failureTitles;return titles[Math.floor(Math.random()*titles.length)];};App.fillFormWithData=function (data){const titleInput=document.getElementById('title');if (titleInput)titleInput.value=data.title;const voteAvgInput=document.getElementById('vote_average');if (voteAvgInput){voteAvgInput.value=data.voteAverage.toFixed(1);const valueDisplay=voteAvgInput.parentElement.querySelector('.range-value');if (valueDisplay)valueDisplay.textContent=data.voteAverage.toFixed(1);}const budgetInput=document.getElementById('budget');if (budgetInput){budgetInput.value=data.budget;}const revenueInput=document.getElementById('revenue');if (revenueInput){revenueInput.value=data.revenue;}const runtimeInput=document.getElementById('runtime');if (runtimeInput){runtimeInput.value=data.runtime;const valueDisplay=runtimeInput.parentElement.querySelector('.range-value');if (valueDisplay)valueDisplay.textContent=data.runtime+' ph√∫t';}const releaseMonth=data.releaseMonth;const monthNames=['','Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];const releaseDate=document.getElementById('release_date');if (releaseDate){const today=new Date();const year=today.getFullYear();const day='01';const month=String(releaseMonth).padStart(2,'0');releaseDate.value=`${year}-${month}-${day}`;}const genresInput=document.getElementById('genres');if (genresInput){document.querySelectorAll('.genre-chip.active').forEach(chip=>{chip.classList.remove('active');});data.genres.forEach(genreToSelect=>{const genreChip=document.querySelector(`.genre-chip[data-genre="${genreToSelect}"]`);if (genreChip){genreChip.classList.add('active');}});genresInput.value=data.genres.join(',');}console.log('‚úÖ Form filled with random data:',data);};function initializeEnhancements(){console.log('üöÄ Initializing UX/UI enhancements...');setupRealTimeValidation();setupEnhancedTooltips();setupLoadingState();setupQuickFillEnhancements();setupAccessibility();updateFormProgress();animateTrustIndicators();console.log('‚úÖ All enhancements initialized successfully!');}document.addEventListener('DOMContentLoaded',()=>{App.init();initializeEnhancements();setupQuickFillButtons();console.log('üé¨ FilmPredict App with Enhancements ready!');});